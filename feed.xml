<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Yun Blog</title>
  <icon>https://www.gravatar.com/avatar/d313a2c442931458ed624a3999d75011</icon>
  <subtitle>기술 블로</subtitle>
  <link href="/feed.xml" rel="self"/>
  
  <link href="https://cheese10yun.github.io/"/>
  <updated>2018-10-26T16:45:12.496Z</updated>
  <id>https://cheese10yun.github.io/</id>
  
  <author>
    <name>Yun</name>
    <email>cheese10yun@gmail.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Spring REST Docs</title>
    <link href="https://cheese10yun.github.io/spring-rest-docs/"/>
    <id>https://cheese10yun.github.io/spring-rest-docs/</id>
    <published>2018-10-26T15:00:00.000Z</published>
    <updated>2018-10-26T16:45:12.496Z</updated>
    
    <content type="html"><![CDATA[<p><strong>코드는 <a href="https://github.com/cheese10yun/springboot-restdocs#test-code-%EC%84%A4%EC%A0%95" rel="external nofollow noopener noreferrer" target="_blank">GitHub</a>에 공개 되어 있습니다.</strong></p><h2><span id="rest-docs-소개">REST Docs 소개</span></h2><p>Spring REST Docs는 테스트 코드 기반으로 RESTful 문서생성을 돕는 도구로 기본적으로 Asciidoctor를 사용하여 HTML를 생성합니다. Spring MVC 테스트 프레임워크로 생성된 snippet을 사용해서 snippet이 올바르지 않으면 생성된 테스트가 실패하여 정확성을 보장해줍니다.</p><h2><span id="rest-docs-vs-swagger">Rest Docs vs Swagger</span></h2><p>우선 Rest Docs과 Swagger는 성격이 많이 다르다고 생각합니다. Swagger는 RESTful 문서에 대한 명세 보다는 Postman Tool 처럼 특정 API를 쉽게 호출해볼수 있는 것에 초점이 맞춰져있다고 생각합니다. 다시 말해 Swagger는 API 명세에 대한 기능은 어느정도 제공해주지만 그것은 효율적이지 못하다고 생각합니다.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@ApiOperation</span>(value = <span class="string">"View a list of available products"</span>, response = Iterable.class)</div><div class="line"><span class="meta">@ApiResponses</span>(value = &#123;</div><div class="line">        <span class="meta">@ApiResponse</span>(code = <span class="number">200</span>, message = <span class="string">"Successfully retrieved list"</span>),</div><div class="line">        <span class="meta">@ApiResponse</span>(code = <span class="number">401</span>, message = <span class="string">"You are not authorized to view the resource"</span>),</div><div class="line">        <span class="meta">@ApiResponse</span>(code = <span class="number">403</span>, message = <span class="string">"Accessing the resource you were trying to reach is forbidden"</span>),</div><div class="line">        <span class="meta">@ApiResponse</span>(code = <span class="number">404</span>, message = <span class="string">"The resource you were trying to reach is not found"</span>)</div><div class="line">&#125;</div><div class="line">)</div><div class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/list"</span>, method= RequestMethod.GET, produces = <span class="string">"application/json"</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> Iterable <span class="title">list</span><span class="params">(Model model)</span></span>&#123;</div><div class="line">    Iterable productList = productService.listAllProducts();</div><div class="line">    <span class="keyword">return</span> productList;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li><a href="https://springframework.guru/spring-boot-restful-api-documentation-with-swagger-2/" rel="external nofollow noopener noreferrer" target="_blank">코드 출처</a></li></ul><p>Swagger는 RESTful에대한 문서명세를 위와같은 어노테이션 방법으로 제공해줍니다. 이런 방법은 다음과 같은 단점이 있다고 생각합니다.</p><ul><li>실제 코드에 영향을 미치지 않지만 지속해서 추가됨으로써 실제 코드보다 문서 명세에 대한 코드가 더 길어져 전체적인 가독성이 떨어집니다.</li><li><strong>해당 코드는 주석일뿐 로직에 영향을 미치지 않기 때문에 비즈니스 로직이 변경되더라도 문서를 갱신하지 않아 결국 문서와 코드가 일치하지 않게 됩니다.</strong></li><li><strong>정상적인 Reponse에 대한 명세 일뿐 status 2xx 이외의 값에 대한 정의가 힘듭니다. 이것을 정의하더라도 주석 형태로 정의하게 되어 결국 시간이 지나면 문서와 코드가 일치하지 않게 됩니다.</strong></li></ul><p>제 개인적인 결론은 RESTful API에 대한 명세관점에서는 둘은 비교 대상이 되기 힘들다고 생각합니다. <strong>Rest Docs는 테스트 코드 기반으로 문서가 작성되기 때문에 문서와 실제 코드의 일치성이 높고 테스트코드로 문서가 표현되기 때문에 실제 코드에 어떠한 코드 추가도 필요가 없다는 장점이 크다고 생각합니다.</strong> Swaager이외에도 실제 자바 주석문으로 RESTful API를 명세하는 서비스도 있지만 결국 문서와 코드의 일치성 등 다양항문제로 현재로써는 Rest Docs가 가장 효율적인 RESTful API 명세 도구라고 생각합니다.</p><h2><span id="pomxml-설정">pom.xml 설정</span></h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></div><div class="line">    ...</div><div class="line">    <span class="comment">&lt;!-- (1) --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.restdocs<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-restdocs-mockmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- (2) --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.asciidoctor<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>asciidoctor-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">executions</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">execution</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">id</span>&gt;</span>generate-docs<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">phase</span>&gt;</span>prepare-package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">goals</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">goal</span>&gt;</span>process-asciidoc<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">backend</span>&gt;</span>html<span class="tag">&lt;/<span class="name">backend</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">doctype</span>&gt;</span>book<span class="tag">&lt;/<span class="name">doctype</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!-- (3) --&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.restdocs<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-restdocs-asciidoctor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- (4) --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-resources-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">executions</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">execution</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">id</span>&gt;</span>copy-resources<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">phase</span>&gt;</span>prepare-package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">goals</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">goal</span>&gt;</span>copy-resources<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span></div><div class="line">                        $&#123;project.build.outputDirectory&#125;/static/docs</div><div class="line">                    <span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">resources</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></div><div class="line">                            <span class="tag">&lt;<span class="name">directory</span>&gt;</span></div><div class="line">                                $&#123;project.build.directory&#125;/generated-docs</div><div class="line">                            <span class="tag">&lt;/<span class="name">directory</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></div></pre></td></tr></table></figure><ul><li>(1) <code>restdocs</code> 의존성을 추가합니다. <code>scope</code>는 test로 지정합니다.</li><li>(2) <code>asciidoctor</code> 플러그인을 추가합니다.</li><li>(3) <code>spring-restdocs-asciidoctor</code> 의존성을 추가합니다. 해당 의존성이 추가되면 <code>snippets</code> 이 자동으로 구성됩니다.</li><li>(4) <code>Asciidoctor</code> 플러그인 설정 입니다.<ul><li><code>outputDirectory</code> 문서가 출력되는 디렉토리 경로 입니다. 실제 <code>/target/classes/static/docs/</code> 경로에 문서가 생셩됩니다.</li></ul></li></ul><h2><span id="test-code">Test Code</span></h2><h3><span id="test-code-설정">Test Code 설정</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</div><div class="line"><span class="meta">@SpringBootTest</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MemberControllerTest</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Rule</span> <span class="keyword">public</span> JUnitRestDocumentation restDocumentation = <span class="keyword">new</span> JUnitRestDocumentation(); <span class="comment">// (1)</span></div><div class="line">    <span class="meta">@Autowired</span> <span class="keyword">private</span> WebApplicationContext context;</div><div class="line">    <span class="keyword">private</span> MockMvc mockMvc; <span class="comment">// (2)</span></div><div class="line">    <span class="keyword">private</span> RestDocumentationResultHandler document;</div><div class="line"></div><div class="line">    <span class="comment">// (3)</span></div><div class="line">    <span class="meta">@Before</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.document = document(</div><div class="line">                <span class="string">"&#123;class-name&#125;/&#123;method-name&#125;"</span>, </div><div class="line">                preprocessResponse(prettyPrint())</div><div class="line">        );</div><div class="line"></div><div class="line">        <span class="keyword">this</span>.mockMvc = MockMvcBuilders.webAppContextSetup(<span class="keyword">this</span>.context)</div><div class="line">                .apply(documentationConfiguration(<span class="keyword">this</span>.restDocumentation))</div><div class="line">                .alwaysDo(document)</div><div class="line">                .build();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>(1) Spring Rest Docs는 <code>JUnit</code> <code>TestNG</code> 등 다양한 테스트 프레임워크를 지원합니다. 본 예제는 <code>JUnit</code> 기반으로 테스트를 진행 하기 때문에 <code>JUnitRestDocumentation</code> 객체를 생성했습니다.</li><li>(2) <code>MockMvc</code>, <code>WebTestClient</code>, <code>Rest Assured</code> 등 다양한 방식으로 Controller에 대한 테스트를 진행 할 수 있습니다. 본 예제는 <code>MockMvc</code> 기반으로 Controller 테스트를 진행하겠습니다.</li><li>(3) <code>RestDocumentationResultHandler</code> 객체와 <code>MockMvc</code> 객체를 생성합니다.<ul><li><code>{class-name}/{method-name}</code> 설정은 해당 테스트 클래스의 이름 메서드 이름 기반으로 디렉토리 경로를 설정해서  <code>snippets</code>을 생성합니다. <code>target/generated-snippets/member-controller-test/get_member</code>에 저장됩니다.</li><li><code>preprocessResponse(prettyPrint()</code> 설정을 통해서 해당 문서가 이쁘게 출력됩니다. 예를들어 JSON Response 값이 JSON 포멧팅에 맞게 출력됩니다.</li><li><code>alwaysDo()</code> 메서드로 위에서 생성된 <code>RestDocumentationResultHandler</code> 객체를 의존성 주입해줍니다. 모든 <code>mockMvc</code> 테스트에 대한 <code>snippets</code>이 생성됩니다.</li></ul></li></ul><h3><span id="member-조회-test-code">Member 조회 Test Code</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</div><div class="line"><span class="meta">@SpringBootTest</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MemberControllerTest</span> </span>&#123;</div><div class="line">    ...</div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">get_member</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        mockMvc.perform(get(<span class="string">"/members/&#123;id&#125;"</span>, <span class="number">1L</span>)</div><div class="line">                .accept(MediaType.APPLICATION_JSON))</div><div class="line">                .andDo(print())</div><div class="line">                .andExpect(status().isOk())</div><div class="line">                .andDo(document.document(</div><div class="line">                        <span class="comment">// (1)</span></div><div class="line">                        pathParameters(</div><div class="line">                                parameterWithName(<span class="string">"id"</span>).description(<span class="string">"Member's id"</span>)</div><div class="line">                        ),</div><div class="line">                        <span class="comment">// (2)</span></div><div class="line">                        responseFields(</div><div class="line">                                fieldWithPath(<span class="string">"email.value"</span>).description(<span class="string">"The Member's email address"</span>),</div><div class="line">                                fieldWithPath(<span class="string">"address.city"</span>).description(<span class="string">"The Member's address city"</span>),</div><div class="line">                                fieldWithPath(<span class="string">"address.street"</span>).description(<span class="string">"The Member's address street"</span>),</div><div class="line">                                fieldWithPath(<span class="string">"address.zipCode"</span>).description(<span class="string">"The Member's address zipCode"</span>)</div><div class="line">                        )</div><div class="line">                ))</div><div class="line">                .andExpect(jsonPath(<span class="string">"$.email.value"</span>, is(notNullValue())))</div><div class="line">                .andExpect(jsonPath(<span class="string">"$.address.city"</span>, is(notNullValue())))</div><div class="line">                .andExpect(jsonPath(<span class="string">"$.address.street"</span>, is(notNullValue())))</div><div class="line">                .andExpect(jsonPath(<span class="string">"$.address.zipCode"</span>, is(notNullValue())))</div><div class="line">        ;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>(1) Path Parameter에 대한 정의 입니다. <code>parameterWithName(&quot;id&quot;).description(&quot;Member's id&quot;)</code> 설정을 통해서 간단하게 문서화가 가능합니다.</li><li>(2) <code>responseFields()</code> 메서드로 reponse 값들에 대한 문서 정의가 가능합니다.</li></ul><p>실제 Document 모습입니다.</p><p algin="cneter">    <img src="https://github.com/cheese10yun/springboot-restdocs/raw/master/assets/member-document.png"></p><p>기본적으로 <code>snippets</code>은 6개가 생성됩니다.</p><p algin="cneter">    <img src="https://github.com/cheese10yun/springboot-restdocs/raw/master/assets/target.png"></p><p>기본 <code>snippets</code> 6개 이외에도  <code>path-parameters.adoc</code>, <code>response-fields.adoc</code> 이 추가로 생성된 것을 확인 할 수 있습니다. 이것은 (1), (2) 에서 추가로 문서 작성 코드를 통해서 작성된 것입니다. 해당  <code>snippets</code>은 만들지 않더라도 기본적인 문서는 갖출 수 있습니다. <strong>하지만 해당 코드를 작성하면 문서와 코드의 일치 성이 높아집니다.</strong></p><p>만약 <code>fieldWithPath(&quot;email.value&quot;).description(&quot;The Member's email address&quot;)</code> 코드를 주석하고 테스트 코드를 실행하게 되면</p><p><img src="https://github.com/cheese10yun/springboot-restdocs/raw/master/assets/member-error.png" alt="member-error"></p><p>위의 그림과 같이 해당 페이로드가 문서화 되지 않았다는 메시지오 함께 테스트 코드가 실패하게 됩니다. 물론 <code>response-body.adoc</code>으로 매번 response 값이 갱신 되기 때문에 문서와의 일치 성은 보장 받을 수 있습니다. 해당 필드 값에 대한 타입과 정의까지 철저 하게 관리하고 싶으시다면 작성하는것도 좋다고 생각합니다.</p><h2><span id="document-구조-adoc-파일-작성">Document 구조 adoc 파일 작성</span></h2><p>테스트코드 기반으로 생성된 <code>snippets</code>을 실제 문서로 만들기 위한 <code>.adoc</code> 파일을 만들어야합니다. 문서의 뼈대 같은 구조를 잡아주는 작업 입니다.</p><p><code>src/main/asciidoc/</code>  경로에 <code>api-guide.adoc</code> 파일을 생성하고 테스트 코드를 통해서 생성된 <code>snippets</code> 파일들을 아래와 같이 추가합니다. <strong><code>api-guide.adoc</code> 파일의 일부분 이라서 전체 파일을 보시는 것이 좋습니다.</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">= Member</div><div class="line"></div><div class="line">== Member 조회</div><div class="line"></div><div class="line">include::&#123;snippets&#125;/member-controller-test/get_member/path-parameters.adoc[]</div><div class="line">include::&#123;snippets&#125;/member-controller-test/get_member/http-response.adoc[]</div><div class="line">include::&#123;snippets&#125;/member-controller-test/get_member/response-fields.adoc[]</div><div class="line">include::&#123;snippets&#125;/member-controller-test/get_member/curl-request.adoc[]</div><div class="line">include::&#123;snippets&#125;/member-controller-test/get_member/http-request.adoc[]</div><div class="line">include::&#123;snippets&#125;/member-controller-test/get_member/httpie-request.adoc[]</div><div class="line">include::&#123;snippets&#125;/member-controller-test/get_member/request-body.adoc[]</div><div class="line">include::&#123;snippets&#125;/member-controller-test/get_member/response-body.adoc[]</div></pre></td></tr></table></figure><h2><span id="최종-document">최종 Document</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mvn install</div><div class="line">mvn spring-boot:run</div></pre></td></tr></table></figure><p>테스트 코드를 실행하고 스프링 부트를 실행 이후 <a href="http://localhost:8080/docs/api-guide.html" rel="external nofollow noopener noreferrer" target="_blank">http://localhost:8080/docs/api-guide.html</a>를 접속하면 Rest Docs 기반의 문서를 확인 할 수 있습니다.</p><p><img src="https://github.com/cheese10yun/springboot-restdocs/raw/master/assets/document-main.png" alt="document-main"></p><h2><span id="마무리">마무리</span></h2><p>Member 조회 이외의 테스트 코드들도 있으니 프로젝트의 전체 코드를 보시는 것이 좋을 거 같습니다. 위에서 언급했듯이 문서와 코드의 지속적인 일치성, 비즈니스 로직을 가리는 과도한 문서화의 코드들이 침입하지 않는 점 등 제가 생각하기에는 Rest Docs는 정말 좋은 문서 도구라고 생각합니다. 반드시 테스트 코드를 작성해야 한다는 것도 테스트 코드에 익숙하지 않은 상태에서는 조금은 어렵겠지만 반강제적으로라도 테스트 코드를 작성하게 도와주는 점도 있어 이 또한 큰 장점이라고 생각합니다.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;strong&gt;코드는 &lt;a href=&quot;https://github.com/cheese10yun/springboot-restdocs#test-code-%EC%84%A4%EC%A0%95&quot; rel=&quot;external nofollow noopener nor
      
    
    </summary>
    
    
      <category term="Spring" scheme="https://cheese10yun.github.io/tags/Spring/"/>
    
      <category term="REST Docs" scheme="https://cheese10yun.github.io/tags/REST-Docs/"/>
    
      <category term="Document" scheme="https://cheese10yun.github.io/tags/Document/"/>
    
  </entry>
  
  <entry>
    <title>OAuth2 인증 방식 정리</title>
    <link href="https://cheese10yun.github.io/oauth2/"/>
    <id>https://cheese10yun.github.io/oauth2/</id>
    <published>2018-10-21T15:00:00.000Z</published>
    <updated>2018-10-21T15:43:30.047Z</updated>
    
    <content type="html"><![CDATA[<h2><span id="oauth2-승인-방식의-종류">OAuth2 승인 방식의 종류</span></h2><ul><li>Authorization Code Grant Type  : 권한 부여 코드 승인 타입<br>클라이언트가 다른 사용자 대신 특정 리소스에 접근을 요청할 떄 사용됩니다. 리스소 접근을 위한 사용자 명과 비밀번호, 권한 서버에 요청해서 받은 권한 코드를 함ㄲ 활용하여 리소스에 대한 엑세스 토큰을 받는 방식입니다.</li><li>Implicit Grant Type : 암시적 승인<br>권한 부여 코드 승인 타입과 다르게 권한 코드 교환 단계 없이 엑세스 토큰을 즉시 반환받아 이를 인증에 이용하는 방식입니다.</li><li>Resource Owner Password Credentials Grant Type : 리소스 소유자 암호 자격 증명 타입<br>클라이언트가 암호를 사용하여 엑세스 토큰에 대한 사용자의 자격 증명을 교환하는 방식식입니다.</li><li>Client Credentials Grant Type : 클라이언트 자격 증명 타입<br>클라이언트가 컨텍스트 외부에서 액세스 토큰을 얻어 특정 리소스에 접근을 요청할 때 사용하는 방식입니다.</li></ul><h2><span id="authorization-code-grant-type-방식">Authorization Code Grant Type 방식</span></h2><p><img src="https://github.com/cheese10yun/TIL/raw/master/assets/oauth2-doe-grant-type_gnojt19me.png" alt="oauth2-doe-grant-type"></p><ul><li>(1) 클라이언트가 파리미터러 클라이언트 ID, 리다이렉트 URI, 응답 타입을 code로 지정하여 권한 서버에 전달합니다. 정상적으로 인증이 되면 권한 코드 부여 코드를 클라이언트에게 보냅니다.<ul><li>응답 타입은 code, token 이 사용 가능합니다.</li><li><strong>응답 타입이 token 일 경우 암시적 승인 타입에 해당합니다.</strong></li></ul></li><li>(2) 성공적으로 권한 부여 코드를 받은 클라이언트는 권한 부여 코드를 사용하여 엑세스 토큰을 권한 서버에 추가로 요청합니다. 이때 필요한 파라미터는 클라이언트 ID, 클라이언트 비밀번호, 리다이렉트 URI, 인증 타입 입니다.</li><li>(3) 마지막으로 받은 엑세스 토큰을 사용하여 리소스 서버에 사용자의 데이터를 보냅니다.</li></ul><h2><span id="implicit-grant-방식">Implicit Grant 방식</span></h2><p><img src="https://github.com/cheese10yun/TIL/raw/master/assets/Implicit%20Grant.png" alt="Implicit Grant"></p><ul><li>(1) 클라이언트가 파리미터러 클라이언트 ID, 리다이렉트 URI, 응답 타입을 code로 지정하여 권한 서버에 전달합니다. 정상적으로 인증이 되면 권한 코드 부여 코드를 클라이언트에게 보냅니다.<ul><li>응답 타입은 code, token 이 사용 가능합니다.</li><li><strong>응답 타입이 token 일 경우 암시적 승인 타입에 해당합니다.</strong></li></ul></li><li>(2) 응답 해준 Access Token 이 유효한지 검증 요청을 합니다.</li><li>(3) 요청 받은 Access Token 정보에 대한 검증에 대한 응답값을 돌려줍니다.</li><li>(4) 유효한 Access Token 기반으로 Resource Server와 통신합니다.</li></ul><h2><span id="resource-owner-password-credentials-grant-방식">Resource Owner Password Credentials Grant 방식</span></h2><p><img src="https://github.com/cheese10yun/TIL/raw/master/assets/Resource%20Owner%20Password%20Credentials%20Grant.png" alt="Resource Owner Password Credentials Grant"></p><ul><li>(1) 인증을 진행합니다. 대부분 ID, Password를 통해서 자격 증명이 진행됩니다.</li><li>(2) 넘겨 받은 정보기반으로 권한 서버에 Access Token 정보를 요청합니다.</li><li>(3) Access Token 정보를 응답 받습니다. 이때 Refresh Token 정보도 넘겨 줄 수도 있습니다.</li><li>(4) Access Token 기반으로 Resource Server와 통신합니다.</li></ul><h2><span id="client-credentials-grant-type-방식">Client Credentials Grant Type 방식</span></h2><p><img src="https://github.com/cheese10yun/TIL/raw/master/assets/Client%20Credentials%20Grant%20Type.png" alt="Client Credentials Grant Type"></p><ul><li>(1) Access Token 정보를 요청합니다.</li><li>(3) Access Token 정보를 응답합니다. 이때 Refresh Token 정보는 응답하지 않는 것을 권장합니다. 별다른 인증 절차가 없기 떄문에 Refresh Token 까지 넘기지 않는 것이라고 생각합니다.</li><li>(4) Access Token 기반으로 Resource Server와 통신합니다.</li></ul><h2><span id="참고">참고</span></h2><ul><li><a href="http://www.bubblecode.net/en/2016/01/22/understanding-oauth2/" rel="external nofollow noopener noreferrer" target="_blank">OAuth2 이해하기</a></li><li><a href="http://www.hanbit.co.kr/store/books/look.php?p_code=B4458049183" rel="external nofollow noopener noreferrer" target="_blank">처음으로 배우는 스프링 부트2</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2&gt;&lt;span id=&quot;oauth2-승인-방식의-종류&quot;&gt;OAuth2 승인 방식의 종류&lt;/span&gt;&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Authorization Code Grant Type  : 권한 부여 코드 승인 타입&lt;br&gt;
클라이언트가 다른 사용자 대신 특
      
    
    </summary>
    
    
      <category term="OAuth2" scheme="https://cheese10yun.github.io/tags/OAuth2/"/>
    
  </entry>
  
  <entry>
    <title>Spring Social Part 2 데이터베이스에 회원 정보 저장</title>
    <link href="https://cheese10yun.github.io/spring-social-02/"/>
    <id>https://cheese10yun.github.io/spring-social-02/</id>
    <published>2018-09-22T15:00:00.000Z</published>
    <updated>2018-09-23T11:39:01.461Z</updated>
    
    <content type="html"><![CDATA[<p>전체 코드는 <a href="https://github.com/cheese10yun/spring-security-oauth2-social" rel="external nofollow noopener noreferrer" target="_blank">Github</a>를 확인해주세요.</p><p><a href="https://github.com/cheese10yun/spring-security-oauth2-social/blob/master/doc/step-01.md" rel="external nofollow noopener noreferrer" target="_blank">step-01: Google, Facebook 간단한 소셜 인증</a>에서 소셜 기반으로 인증 처리를 진행했습니다. 이번 차례에서는 해당 정보를 데이터베이스에 영속화 시키는 간단한 예제로 Data JPA, H2를 이용하겠습니다.</p><h2><span id="테이블">테이블</span></h2><p><img src="https://github.com/cheese10yun/spring-security-oauth2-social/blob/master/assets/social-table.png?raw=true" alt="social-table"></p><ul><li>user_connection : 소셜에서 넘겨준 프로필에 대한 테이블</li><li>user : 해당 프로젝트의 user 테이블</li></ul><p>전체적은 플로우는 다음과 같습니다.</p><ol><li>소셜에서 회원 인증</li><li>인증된 회원정보 데이터베이스 조회<ul><li>조회되는 경우 -&gt; 기존 유저로 판단, 조화된 정보기반으로 인증처리</li><li>조회되지 않은 경우 -&gt; 신규 유저로 판단, user_connection, user 테이블 저장 저장된 정보기반으로 인증처리</li></ul></li></ol><h2><span id="security">Security</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        <span class="comment">// @formatter:off</span></div><div class="line">        ...</div><div class="line">http.antMatcher(<span class="string">"/**"</span>).authorizeRequests().antMatchers(<span class="string">"/"</span>, <span class="string">"/login**"</span>).permitAll().anyRequest()</div><div class="line">                ...</div><div class="line">.addFilterBefore(ssoFilter(), BasicAuthenticationFilter.class);</div><div class="line"></div><div class="line"><span class="comment">// @formatter:on</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> Filter <span class="title">ssoFilter</span><span class="params">()</span> </span>&#123;</div><div class="line">        CompositeFilter filter = <span class="keyword">new</span> CompositeFilter();</div><div class="line">        List&lt;Filter&gt; filters = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        filters.add(ssoFilter(google(), <span class="keyword">new</span> GoogleOAuth2ClientAuthenticationProcessingFilter(socialService)));</div><div class="line">        filters.add(ssoFilter(facebook(), <span class="keyword">new</span> FacebookOAuth2ClientAuthenticationProcessingFilter(socialService)));</div><div class="line">        filter.setFilters(filters);</div><div class="line">        <span class="keyword">return</span> filter;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> Filter <span class="title">ssoFilter</span><span class="params">(ClientResources client, OAuth2ClientAuthenticationProcessingFilter filter)</span> </span>&#123;</div><div class="line">        OAuth2RestTemplate restTemplate = <span class="keyword">new</span> OAuth2RestTemplate(client.getClient(), oauth2ClientContext);</div><div class="line">        filter.setRestTemplate(restTemplate);</div><div class="line">        UserInfoTokenServices tokenServices = <span class="keyword">new</span> UserInfoTokenServices(client.getResource().getUserInfoUri(), client.getClient().getClientId());</div><div class="line">        filter.setTokenServices(tokenServices);</div><div class="line">        tokenServices.setRestTemplate(restTemplate);</div><div class="line">        <span class="keyword">return</span> filter;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p><a href="https://github.com/cheese10yun/spring-security-oauth2-social/blob/master/doc/step-01.md" rel="external nofollow noopener noreferrer" target="_blank">step-01: Google, Facebook 간단한 소셜 인증</a>의 SecurityConfig 에서 조금 변경한 내용입니다.</p><p>달라진 점은 크게 없고 GoogleOAuth2ClientAuthenticationProcessingFilter, FacebookOAuth2ClientAuthenticationProcessingFilter의 클래스를 기반으로 필터에 등록시켰습니다. 이때 소셜 가입 및 로그인 처리를 담당하는 SocialService를 생성자를 통해서 주입해주었습니다.</p><h2><span id="oauth2clientauthenticationprocessingfilter">OAuth2ClientAuthenticationProcessingFilter</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FacebookOAuth2ClientAuthenticationProcessingFilter</span> <span class="keyword">extends</span> <span class="title">OAuth2ClientAuthenticationProcessingFilter</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</div><div class="line">    <span class="keyword">private</span> SocialService socialService;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FacebookOAuth2ClientAuthenticationProcessingFilter</span><span class="params">(SocialService socialService)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(<span class="string">"/login/facebook"</span>);</div><div class="line">        <span class="keyword">this</span>.socialService = socialService;</div><div class="line">        mapper.configure(DeserializationConfig.Feature.FAIL_ON_UNKNOWN_PROPERTIES, <span class="keyword">false</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">successfulAuthentication</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain chain, Authentication authResult)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</div><div class="line">        <span class="keyword">final</span> OAuth2AccessToken accessToken = restTemplate.getAccessToken(); <span class="comment">// 토큰 정보 가져옴</span></div><div class="line">        <span class="keyword">final</span> OAuth2Authentication auth = (OAuth2Authentication) authResult;</div><div class="line">        <span class="keyword">final</span> Object details = auth.getUserAuthentication().getDetails(); <span class="comment">// 소셜에서 넘겨 받은 정보를 details에 저장</span></div><div class="line">        <span class="keyword">final</span> FacebookUserDetails userDetails = mapper.convertValue(details, FacebookUserDetails.class); <span class="comment">// Object mapper를 이용해서 객체 변환</span></div><div class="line">        userDetails.setAccessToken(accessToken); <span class="comment">// access token 정보도 저장</span></div><div class="line"></div><div class="line">        <span class="keyword">final</span> UserConnection userConnection = UserConnection.valueOf(userDetails); <span class="comment">// UserConnection를 userDetails 기반으로 생성</span></div><div class="line">        <span class="keyword">final</span> UsernamePasswordAuthenticationToken authenticationToken = socialService.doAuthentication(userConnection); <span class="comment">// SocialService를 이용해서 인증 절차 진행</span></div><div class="line"></div><div class="line">        <span class="keyword">super</span>.successfulAuthentication(request, response, chain, authenticationToken);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure><p>OAuth2ClientAuthenticationProcessingFilter 클래스를 상속 받아서 구현한 클래스입니다. successfulAuthentication 메서드는 소셜 인증을 성공되면 호출되는 메서드입니다. 가장 중</p><p><code>restTemplate.getAccessToken()</code> 메서드를 통해서 해당 유저의 access token 정보를 가져옵니다.</p><p>인자로 넘겨받은 authResult 객체에 소셜에서 넘겨받은 정보를 details 객체에 넘겨받습니다. 이때 넘겨받은 정보를 ObejctMapper를 이용해서 FacebookUserDetails로 변환 합니다.</p><p><a href="https://github.com/cheese10yun/spring-security-oauth2-social/blob/master/doc/step-01.md#%EB%82%B4%EB%B6%80-%EC%BD%94%EB%93%9C" rel="external nofollow noopener noreferrer" target="_blank">step-01: Google, Facebook 간단한 소셜 인증</a>에서 보셨듯 소셜에 넘겨주는 profile 객체는 LinkedHashMap의 형태입니다. 실제 런타임 전까지는 정확한 자료형을 확인하기가 어렵습니다. 그래서 FacebookUserDetails DTO 클래스 이용하는 것이 가독성 및 유지 보수하기 좋다고 생각합니다.</p><p>FacebookUserDetails 객체를 기반으로 UserConnection 객체를 만듭니다. UserConnection 객체는 아래에서 설명하겠습니다.</p><h3><span id="doauthentication-메서드">doAuthentication 메서드</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> UsernamePasswordAuthenticationToken <span class="title">doAuthentication</span><span class="params">(UserConnection userConnection)</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (userService.isExistUser(userConnection)) &#123;</div><div class="line">        <span class="comment">// 기존 회원일 경우에는 데이터베이스에서 조회해서 인증 처리</span></div><div class="line">        <span class="keyword">final</span> User user = userService.findBySocial(userConnection);</div><div class="line">        <span class="keyword">return</span> setAuthenticationToken(user);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="comment">// 새 회원일 경우 회원가입 이후 인증 처리</span></div><div class="line">        <span class="keyword">final</span> User user = userService.signUp(userConnection);</div><div class="line">        <span class="keyword">return</span> setAuthenticationToken(user);</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>Data JPA에 대한 설명은 하지 않겠습니다. 데이터베이스에서 회원 존재 유무를 확인 후 기존 회원일 경우는 바로 인증 회원 정보를 리턴합니다. 그렇지 않고 신규 회원일 경우에는 회원 가입을 진행 시킵니다. 이때 user_conncection, user 테이블에 두 곳 모두 저장시킵니다.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">Hibernate: </div><div class="line">    insert </div><div class="line">    into</div><div class="line">        user_connection</div><div class="line">        (access_token, display_name, email, expire_time, image_url, profile_url, provider, provider_id, id) </div><div class="line">    values</div><div class="line">        (?, ?, ?, ?, ?, ?, ?, ?, ?)</div><div class="line"></div><div class="line">Hibernate: </div><div class="line">    insert </div><div class="line">    into</div><div class="line">        user</div><div class="line">        (email, nickname, provider_id, id) </div><div class="line">    values</div><div class="line">        (?, ?, ?, ?)</div></pre></td></tr></table></figure><p>신규 가입일 경우 쿼리입니다. user_connection, user 테이블에 각각 insert가 되는 것을 확인할 수 있습니다.</p><h2><span id="userconnection">UserConnection</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Table</span>(name = <span class="string">"user"</span>)</div><div class="line"><span class="meta">@NoArgsConstructor</span>(access = AccessLevel.PROTECTED)</div><div class="line"><span class="meta">@Getter</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Id</span> <span class="meta">@GeneratedValue</span>(strategy = GenerationType.AUTO)<span class="keyword">private</span> <span class="keyword">long</span> id;</div><div class="line">    ...</div><div class="line"></div><div class="line">    <span class="meta">@OneToOne</span>(cascade = CascadeType.PERSIST)</div><div class="line">    <span class="meta">@JoinColumn</span>(name = <span class="string">"provider_id"</span>, referencedColumnName = <span class="string">"provider_id"</span>, nullable = <span class="keyword">false</span>, updatable = <span class="keyword">false</span>, unique = <span class="keyword">true</span>)</div><div class="line">    <span class="keyword">private</span> UserConnection social;</div><div class="line"></div><div class="line">    <span class="meta">@Builder</span></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">User</span><span class="params">(String email, String nickname, UserConnection social)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.email = email;</div><div class="line">        <span class="keyword">this</span>.nickname = nickname;</div><div class="line">        <span class="keyword">this</span>.social = social;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> User <span class="title">signUp</span><span class="params">(UserConnection userConnection)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> User.builder()</div><div class="line">                .email(userConnection.getEmail())</div><div class="line">                .nickname(userConnection.getDisplayName())</div><div class="line">                .social(userConnection)</div><div class="line">                .build();</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Entity</span></div><div class="line"><span class="meta">@Table</span>(name = <span class="string">"user_connection"</span>)</div><div class="line"><span class="meta">@NoArgsConstructor</span>(access = AccessLevel.PROTECTED)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserConnection</span> </span>&#123;</div><div class="line">    <span class="meta">@Id</span> <span class="meta">@GeneratedValue</span>(strategy = GenerationType.AUTO) <span class="keyword">private</span> <span class="keyword">long</span> id;</div><div class="line">    <span class="meta">@Column</span>(name = <span class="string">"email"</span>) <span class="keyword">private</span> String email;</div><div class="line">    <span class="meta">@Column</span>(name = <span class="string">"provider"</span>) <span class="meta">@Enumerated</span>(EnumType.STRING) <span class="keyword">private</span> ProviderType provider;</div><div class="line">    <span class="meta">@Column</span>(name = <span class="string">"provider_id"</span>, unique = <span class="keyword">true</span>, nullable = <span class="keyword">false</span>) <span class="keyword">private</span> String providerId;</div><div class="line">    <span class="meta">@Column</span>(name = <span class="string">"display_name"</span>) <span class="keyword">private</span> String displayName;</div><div class="line">    <span class="meta">@Column</span>(name = <span class="string">"profile_url"</span>) <span class="keyword">private</span> String profileUrl;</div><div class="line">    <span class="meta">@Column</span>(name = <span class="string">"image_url"</span>) <span class="keyword">private</span> String imageUrl;</div><div class="line">    <span class="meta">@Column</span>(name = <span class="string">"access_token"</span>) <span class="keyword">private</span> String accessToken;</div><div class="line">    <span class="meta">@Column</span>(name = <span class="string">"expire_time"</span>) <span class="keyword">private</span> <span class="keyword">long</span> expireTime;</div><div class="line"></div><div class="line">    ...</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> UserConnection <span class="title">valueOf</span><span class="params">(GoogleUserDetails userDetails)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> UserConnection.builder()</div><div class="line">                .expireTime(userDetails.getExpiration())</div><div class="line">                .accessToken(userDetails.getAccess_token())</div><div class="line">                .providerId(userDetails.getSub())</div><div class="line">                .email(userDetails.getEmail())</div><div class="line">                .displayName(userDetails.getName())</div><div class="line">                .imageUrl(userDetails.getPicture())</div><div class="line">                .provider(ProviderType.GOOGLE)</div><div class="line">                .profileUrl(userDetails.getProfile())</div><div class="line">                .build();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>코드는 길지만 말하고자 하는 것은 단순합니다. 지금 프로젝트에서는 소셜 가입 외에는 회원 인증 절차(회원가입)가 없다는 가정입니다.</p><p>그렇다는 것은 UserConnection 객체가 만들어지는 이유는 단 한 가지입니다. Google, Facebook를 통한 회원 인증일 경우입니다. UserConnection 위의 코드를 보시면 알겠지만 UserConnection 객체를 만들 수 있는 것은 방법은 <code>valueOf</code> 객체뿐입니다. (JPA 프록시객체 때문에 protected 생성자는 만들어야 합니다.)</p><p>이 처럼 객체의 생성도 명확한 근거 외에는 생성을 제한하는 좋은 구조라고 생각합니다. 또 User 객체도 마찬가지입니다. 소셜 회원 가입 이외에는 회원가입이 없으므로 User 객체는 UserConnection를 기반으로 만드는 방법 말고 제공하지 않는 것도 마찬가지입니다.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;전체 코드는 &lt;a href=&quot;https://github.com/cheese10yun/spring-security-oauth2-social&quot; rel=&quot;external nofollow noopener noreferrer&quot; target=&quot;_blank&quot;
      
    
    </summary>
    
    
      <category term="Spring" scheme="https://cheese10yun.github.io/tags/Spring/"/>
    
      <category term="OAuth2" scheme="https://cheese10yun.github.io/tags/OAuth2/"/>
    
      <category term="Social" scheme="https://cheese10yun.github.io/tags/Social/"/>
    
  </entry>
  
  <entry>
    <title>Spring Social Part 1 Google, Facebook 간단한 소셜 인증</title>
    <link href="https://cheese10yun.github.io/spring-social/"/>
    <id>https://cheese10yun.github.io/spring-social/</id>
    <published>2018-09-14T15:00:00.000Z</published>
    <updated>2018-09-15T15:10:19.582Z</updated>
    
    <content type="html"><![CDATA[<p>전체 코드는 <a href="https://github.com/cheese10yun/spring-security-oauth2-social" rel="external nofollow noopener noreferrer" target="_blank">Github</a>를 확인해주세요.</p><h1><span id="소셜-인증">소셜 인증</span></h1><p>Spring Scurity OAuth2를 활용해서 Facebook, Google 계정 기반으로 정말 간단하게 인증 처리를 할 수 있습니다. 들어가기에 앞서 <a href="https://github.com/minwan1/spring-security-oauth2-example/blob/master/docs/step-1%3Aoauth1%2Coauth2%EB%9E%80.md#%EC%9D%B8%EC%A6%9D-%EC%A2%85%EB%A5%98" rel="external nofollow noopener noreferrer" target="_blank">OAuth 2인증 방식 : Authorization Code Grant</a> <strong>반드시 기본적인 이해를 하시는것을 권장드립니다.</strong> <a href="https://www.youtube.com/watch?v=hm2r6LtUbk8&amp;index=1&amp;list=PLuHgQVnccGMA4guyznDlykFJh28_R08Q-" rel="external nofollow noopener noreferrer" target="_blank">생활코딩</a>에도 잘 정의되어있습니다.</p><p>Google, Facebook App 생성 및 Https 설정을 하지 않았다면 <a href="https://github.com/cheese10yun/spring-security-oauth2-social/blob/master/doc/step-00.md" rel="external nofollow noopener noreferrer" target="_blank">step-00: gogole, facebook, https 설정</a>을 참고하여 작업을 완료해주세요</p><h2><span id="프로젝트-기본-설정">프로젝트 기본 설정</span></h2><h3><span id="maven">maven</span></h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.security.oauth<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-security-oauth2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.security.oauth.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-security-oauth2-autoconfigure<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure><h3><span id="applicationyml">application.yml</span></h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="attr">facebook:</span></div><div class="line"><span class="attr">  client:</span></div><div class="line"><span class="attr">    clientId:</span> <span class="string">&lt;your-client-id&gt;</span></div><div class="line"><span class="attr">    clientSecret:</span> <span class="string">&lt;your-secret&gt;</span></div><div class="line"><span class="attr">    accessTokenUri:</span> <span class="attr">https://graph.facebook.com/oauth/access_token</span></div><div class="line"><span class="attr">    userAuthorizationUri:</span> <span class="attr">https://www.facebook.com/dialog/oauth</span></div><div class="line"><span class="attr">    tokenName:</span> <span class="string">oauth_token</span></div><div class="line"><span class="attr">    authenticationScheme:</span> <span class="string">query</span></div><div class="line"><span class="attr">    clientAuthenticationScheme:</span> <span class="string">form</span></div><div class="line"><span class="attr">  resource:</span></div><div class="line"><span class="attr">    userInfoUri:</span> <span class="attr">https://graph.facebook.com/me</span></div><div class="line"></div><div class="line"><span class="string">google</span> <span class="string">:</span></div><div class="line">  <span class="string">client</span> <span class="string">:</span></div><div class="line">    <span class="string">clientId</span> <span class="string">:</span> <span class="string">&lt;your-client&gt;</span></div><div class="line"><span class="attr">    clientSecret:</span> <span class="string">&lt;your-secret&gt;</span></div><div class="line"><span class="attr">    accessTokenUri:</span> <span class="attr">https://www.googleapis.com/oauth2/v4/token</span></div><div class="line"><span class="attr">    userAuthorizationUri:</span> <span class="attr">https://accounts.google.com/o/oauth2/v2/auth</span></div><div class="line"><span class="attr">    clientAuthenticationScheme:</span> <span class="string">form</span></div><div class="line"><span class="attr">    scope:</span></div><div class="line"><span class="bullet">    -</span> <span class="string">email</span></div><div class="line"><span class="bullet">    -</span> <span class="string">profile</span></div><div class="line"><span class="attr">  resource:</span></div><div class="line"><span class="attr">    userInfoUri:</span> <span class="attr">https://www.googleapis.com/oauth2/v3/userinfo</span></div></pre></td></tr></table></figure><h2><span id="소셜-인증-구현">소셜 인증 구현</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClientResources</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@NestedConfigurationProperty</span></div><div class="line">    <span class="keyword">private</span> AuthorizationCodeResourceDetails client = <span class="keyword">new</span> AuthorizationCodeResourceDetails();</div><div class="line"></div><div class="line">    <span class="meta">@NestedConfigurationProperty</span></div><div class="line">    <span class="keyword">private</span> ResourceServerProperties resource = <span class="keyword">new</span> ResourceServerProperties();</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> AuthorizationCodeResourceDetails <span class="title">getClient</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> client;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> ResourceServerProperties <span class="title">getResource</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> resource;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>ClientResources 클래스를 생성합니다. 해당 클래스는 위에서 설정한 property 설정을 편리하게 사용할 수 있습니다.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@EnableWebSecurity</span></div><div class="line"><span class="meta">@EnableOAuth</span>2Client</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</div><div class="line"></div><div class="line">  ....</div><div class="line">  <span class="meta">@Bean</span></div><div class="line">    <span class="meta">@ConfigurationProperties</span>(<span class="string">"facebook"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> ClientResources <span class="title">facebook</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ClientResources();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Bean</span></div><div class="line">    <span class="meta">@ConfigurationProperties</span>(<span class="string">"google"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> ClientResources <span class="title">google</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ClientResources();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>EnableWebSecurity, EnableOAuth2Client 어노테이션을 추가합니다.</p><p>위에서 작성한 properties 들을 빈으로 등록해줍니다. ClientResources 클래스 덕분에 저렇게 쉽게 property 설정을 쉽게 설정할 수 있습니다.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</div><div class="line">  ...</div><div class="line">  <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        <span class="comment">// @formatter:off</span></div><div class="line">http.antMatcher(<span class="string">"/**"</span>).authorizeRequests().antMatchers(<span class="string">"/"</span>, <span class="string">"/login**"</span>).permitAll().anyRequest()</div><div class="line">.authenticated().and().exceptionHandling()</div><div class="line">.authenticationEntryPoint(<span class="keyword">new</span> LoginUrlAuthenticationEntryPoint(<span class="string">"/"</span>)).and()</div><div class="line">.addFilterBefore(ssoFilter(), BasicAuthenticationFilter.class);</div><div class="line"></div><div class="line"><span class="comment">// logout</span></div><div class="line">http.logout()</div><div class="line">                .invalidateHttpSession(<span class="keyword">true</span>)</div><div class="line">                .clearAuthentication(<span class="keyword">true</span>)</div><div class="line">                .logoutRequestMatcher(<span class="keyword">new</span> AntPathRequestMatcher(<span class="string">"/logout"</span>))</div><div class="line">                    .logoutSuccessUrl(<span class="string">"/"</span>)</div><div class="line">                .permitAll();</div><div class="line"><span class="comment">// @formatter:on</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>스프링 시큐리티 코드입니다. 해당 설정은 어렵지 않으니 자세한 설명은 생략하겠습니다. 중요한 포인트는 addFilterBefore메서드로 ssoFilter 필터를 등록했습니다. 해당 필터는 아래에서 다루겠습니다.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</div><div class="line">  ...</div><div class="line"></div><div class="line">  <span class="meta">@Bean</span></div><div class="line">      <span class="function"><span class="keyword">public</span> FilterRegistrationBean <span class="title">oauth2ClientFilterRegistration</span><span class="params">(OAuth2ClientContextFilter filter)</span> </span>&#123;</div><div class="line">          FilterRegistrationBean registration = <span class="keyword">new</span> FilterRegistrationBean();</div><div class="line">          registration.setFilter(filter);</div><div class="line">          registration.setOrder(-<span class="number">100</span>);</div><div class="line">          <span class="keyword">return</span> registration;</div><div class="line">      &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>인증 요청에 따른 리다이렉션을 위한 빈을 등록합니다. 이때 setOrder 메서드로 Spring Security 필터 보다 우선순위를 낮게 설정합니다.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</div><div class="line">  ...</div><div class="line">  <span class="function"><span class="keyword">private</span> Filter <span class="title">ssoFilter</span><span class="params">()</span> </span>&#123;</div><div class="line">        CompositeFilter filter = <span class="keyword">new</span> CompositeFilter();</div><div class="line">        List&lt;Filter&gt; filters = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        filters.add(ssoFilter(google(), <span class="string">"/login/google"</span>)); <span class="comment">//  이전에 등록했던 OAuth 리다이렉트 URL </span></div><div class="line">        filters.add(ssoFilter(facebook(), <span class="string">"/login/facebook"</span>));</div><div class="line">        filter.setFilters(filters);</div><div class="line">        <span class="keyword">return</span> filter;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> Filter <span class="title">ssoFilter</span><span class="params">(ClientResources client, String path)</span> </span>&#123;</div><div class="line">        OAuth2ClientAuthenticationProcessingFilter filter = <span class="keyword">new</span> OAuth2ClientAuthenticationProcessingFilter(path);</div><div class="line">        OAuth2RestTemplate restTemplate = <span class="keyword">new</span> OAuth2RestTemplate(client.getClient(), oauth2ClientContext);</div><div class="line">        filter.setRestTemplate(restTemplate);</div><div class="line">        UserInfoTokenServices tokenServices = <span class="keyword">new</span> UserInfoTokenServices(client.getResource().getUserInfoUri(), client.getClient().getClientId());</div><div class="line">        tokenServices.setRestTemplate(restTemplate);</div><div class="line">        filter.setTokenServices(tokenServices);</div><div class="line">        <span class="keyword">return</span> filter;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>위에서 configure 등록했던 ssoFilter 설정 입니다. 위에서 등록했던 빈 google(), 이전에 등록했던 OAuth 리다이렉트 URL <code>/login/google</code> 기반으로 Filter를 생성합니다.</p><p><strong>OAuth2ClientAuthenticationProcessingFilter 필터는 인증 서버에서 OAuth2 액세스 토큰을 획득하고 인증 객체를 SecurityContext에로드하는 데 사용할 수 있는 OAuth2 클라이언트 필터입니다.</strong></p><p>setRestTemplate 메스들을 통해서 OAuth2 인증 REST 요청을 만들 수 있는 RestTemplate 객체를 지정합니다.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RestController</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Controller</span> </span>&#123;</div><div class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/"</span>, method = RequestMethod.GET)</div><div class="line">    <span class="function"><span class="keyword">public</span> Principal <span class="title">home</span><span class="params">(Principal principal)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> principal;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>소셜 인증 이후 해당 컨트롤러로 이동하면 OAuth2ClientAuthenticationProcessingFilter 필터가 등록한  SecurityContextHolder 정보를 확인할 수 있습니다.</p><h2><span id="소셜-인증">소셜 인증</span></h2><h3><span id="facebook">Facebook</span></h3><p><img src="https://github.com/cheese10yun/spring-security-oauth2-social/raw/master/assets/facebook.png" alt="facebook"><br><a href="https://localhost:8080/login/facebook" rel="external nofollow noopener noreferrer" target="_blank">https://localhost:8080/login/facebook</a> 페이스북 로그인</p><h3><span id="google">Google</span></h3><p><img src="https://github.com/cheese10yun/spring-security-oauth2-social/raw/master/assets/google.png" alt="google"><br><a href="https://localhost:8080/login/google" rel="external nofollow noopener noreferrer" target="_blank">https://localhost:8080/login/google</a> 구글 로그인</p><h2><span id="내부-코드">내부 코드</span></h2><p>별다른 설정 없이 Spring Scurity OAuth2 활용하면 어렵지 않게 소셜 기반으로 인증 처리를 구현할 수 있습니다. 가장 핵심적인 클래스 OAuth2ClientAuthenticationProcessingFilter 클래스를 살펴보겠습니다.</p><h3><span id="attemptauthentication-메서드">attemptAuthentication 메서드</span></h3><p><img src="https://github.com/cheese10yun/spring-security-oauth2-social/raw/master/assets/attemptAuthentication.png" alt="attemptAuthentication"></p><p>소셜 인증을 시도하는 메서드로 위에서 등록했던 restTemplate 으로 Access Token 을 가져오고 해당 토큰 값으로 사용자 정보를 가져옵니다.</p><p>위 그림은 break point를 찍은 화면으로 acctessToken에는 accessToken, socpe, expriation 가 있고 userAuthenication에는 소셜에서 받아온 회원정보가 있습니다.</p><h3><span id="successfulauthentication-메서드">successfulAuthentication 메서드</span></h3><p><img src="https://github.com/cheese10yun/spring-security-oauth2-social/raw/master/assets/successfulAuthentication.png" alt="successfulAuthentication"></p><p>attemptAuthentication 에서 인증이 성공되었다면 이후에 successfulAuthentication 메서드를 호출하게 됩니다.</p><p>여기서 중요한 포인트는 authResut 값을 <code>super.successfulAuthentication(request, response, chain, authResult);</code> 메서드를 통해서 SecurityContextHolder에 저장되게 됩니다. 즉 소셜에서 받아온 정보 기반으로 인증 처리를 합니다.</p><h3><span id="인증-정보">인증 정보</span></h3><p><img src="https://raw.githubusercontent.com/cheese10yun/spring-security-oauth2-social/master/assets/login-info.png" alt="login-info"></p><p><a href="https://localhost:8080/" rel="external nofollow noopener noreferrer" target="_blank">https://localhost:8080/</a> 에서 해당 유저의 세션 정보를 확인 할 수 있습니다.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;전체 코드는 &lt;a href=&quot;https://github.com/cheese10yun/spring-security-oauth2-social&quot; rel=&quot;external nofollow noopener noreferrer&quot; target=&quot;_blank&quot;
      
    
    </summary>
    
    
      <category term="Spring" scheme="https://cheese10yun.github.io/tags/Spring/"/>
    
      <category term="OAuth2" scheme="https://cheese10yun.github.io/tags/OAuth2/"/>
    
      <category term="Social" scheme="https://cheese10yun.github.io/tags/Social/"/>
    
  </entry>
  
  <entry>
    <title>Spring Boot HTTPS 적용 하기</title>
    <link href="https://cheese10yun.github.io/spring-https/"/>
    <id>https://cheese10yun.github.io/spring-https/</id>
    <published>2018-09-09T15:00:00.000Z</published>
    <updated>2018-09-15T15:06:07.109Z</updated>
    
    <content type="html"><![CDATA[<h2><span id="spring-boot-https-적용하기">Spring Boot HTTPS 적용하기</span></h2><p>스프링 부트에서는 정말 간단하게 Https를 적용할 수 있습니다.</p><h2><span id="키스토어-생성">키스토어 생성</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">keytool -genkey -alias tomcat -storetype PKCS12 -keyalg RSA -keysize 2048 -keystore keystore.p12 -validity 4000</div><div class="line"></div><div class="line">키 저장소 비밀번호 입력:</div><div class="line">새 비밀번호 다시 입력:</div><div class="line">이름과 성을 입력하십시오.</div><div class="line">  [Unknown]:  test</div><div class="line">조직 단위 이름을 입력하십시오.</div><div class="line">  [Unknown]:  test</div><div class="line">조직 이름을 입력하십시오.</div><div class="line">  [Unknown]:  test</div><div class="line">구/군/시 이름을 입력하십시오?</div><div class="line">  [Unknown]:  test</div><div class="line">시/도 이름을 입력하십시오.</div><div class="line">  [Unknown]:  test</div><div class="line">이 조직의 두 자리 국가 코드를 입력하십시오.</div><div class="line">  [Unknown]:  01</div><div class="line">CN=test, OU=test, O=test, L=test, ST=test, C=01이(가) 맞습니까?</div><div class="line">  [아니오]:  y</div></pre></td></tr></table></figure><h2><span id="properties-설정">properties 설정</span></h2><h3><span id="yml">YML</span></h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="attr">server:</span></div><div class="line"><span class="attr">  ssl:</span></div><div class="line"><span class="attr">    key-store:</span> <span class="string">keystore.p12</span></div><div class="line"><span class="attr">    key-store-password:</span> <span class="string">cheese</span></div><div class="line"><span class="attr">    keyStoreType:</span> <span class="string">PKCS12</span></div><div class="line"><span class="attr">    keyAlias:</span> <span class="string">tomcat</span></div></pre></td></tr></table></figure><h3><span id="properties">Properties</span></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">server.ssl.key-store: keystore.p12</div><div class="line">server.ssl.key-store-password: cheese</div><div class="line">server.ssl.keyStoreType: PKCS12</div><div class="line">server.ssl.keyAlias: tomcat</div></pre></td></tr></table></figure><h2><span id="https-요청">https 요청</span></h2><p><img src="https://github.com/cheese10yun/blog-sample/blob/master/spring-https/assets/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202018-09-10%20%EC%98%A4%EC%A0%84%202.01.38.png?raw=true" alt="스크린샷 2018-09-10 오전 2.01.38"></p><p><img src="https://raw.githubusercontent.com/cheese10yun/blog-sample/master/spring-https/assets/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202018-09-10%20%EC%98%A4%EC%A0%84%202.01.42.png" alt="스크린샷 2018-09-10 오전 2.01.42"></p><ul><li><a href="https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81%EB%B6%80%ED%8A%B8" rel="external nofollow noopener noreferrer" target="_blank">스프링 부트</a> 참고</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2&gt;&lt;span id=&quot;spring-boot-https-적용하기&quot;&gt;Spring Boot HTTPS 적용하기&lt;/span&gt;&lt;/h2&gt;
&lt;p&gt;스프링 부트에서는 정말 간단하게 Https를 적용할 수 있습니다.&lt;/p&gt;
&lt;h2&gt;&lt;span id=&quot;키스토어-생성&quot;&gt;
      
    
    </summary>
    
    
      <category term="Spring" scheme="https://cheese10yun.github.io/tags/Spring/"/>
    
      <category term="Https" scheme="https://cheese10yun.github.io/tags/Https/"/>
    
  </entry>
  
  <entry>
    <title>Spring-Jpa Best Practices step-10 - Properties 설정값 가져오기</title>
    <link href="https://cheese10yun.github.io/spring-jpa-best-10/"/>
    <id>https://cheese10yun.github.io/spring-jpa-best-10/</id>
    <published>2018-08-04T15:00:00.000Z</published>
    <updated>2018-08-05T10:33:52.098Z</updated>
    
    <content type="html"><![CDATA[<p>해당 코드는 <a href="https://github.com/cheese10yun/spring-jpa-best-practices" rel="external nofollow noopener noreferrer" target="_blank">Github</a>를 확인해주세요.</p><p>Properties 설정값을 가져오는 다양한 방법들이 있습니다. 방법이 많다 보니 좋지 않은 패턴으로 사용하는 예도 흔하게 발생합니다. 안티 패턴을 소개하고 이것이 왜 안 좋은지 간단하게 소개하고 제가 생각하는 좋은 패턴도 소개해드리겠습니다.</p><h2><span id="properties">properties</span></h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="attr">user:</span></div><div class="line"><span class="attr">  email:</span> <span class="string">"yun@test.com"</span></div><div class="line"><span class="attr">  nickname:</span> <span class="string">"yun"</span></div><div class="line"><span class="attr">  age:</span> <span class="number">28</span></div><div class="line"><span class="attr">  auth:</span> <span class="literal">false</span></div><div class="line"><span class="attr">  amount:</span> <span class="number">101</span></div></pre></td></tr></table></figure><p>properties 설정은 위와 같습니다. 참고로 .yml 설정 파일입니다.</p><h2><span id="안티패턴-environment">안티패턴 : Environment</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AntiSamplePropertiesRunner</span> <span class="keyword">implements</span> <span class="title">ApplicationRunner</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Environment env;</div><div class="line">    </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(ApplicationArguments args)</span>  </span>&#123;</div><div class="line">        <span class="keyword">final</span> String email = env.getProperty(<span class="string">"user.email"</span>);</div><div class="line">        <span class="keyword">final</span> String nickname = env.getProperty(<span class="string">"user.nickname"</span>);</div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> age = Integer.valueOf(env.getProperty(<span class="string">"user.age"</span>));</div><div class="line">        <span class="keyword">final</span> <span class="keyword">boolean</span> auth = Boolean.valueOf(env.getProperty(<span class="string">"user.auth"</span>));</div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> amount = Integer.valueOf(env.getProperty(<span class="string">"user.amount"</span>));</div><div class="line"></div><div class="line">        log.info(<span class="string">"=========ANTI========="</span>);</div><div class="line">        log.info(email); <span class="comment">// "yun@test.com"</span></div><div class="line">        log.info(nickname); <span class="comment">// yun</span></div><div class="line">        log.info(String.valueOf(age)); <span class="comment">// 27</span></div><div class="line">        log.info(String.valueOf(auth)); <span class="comment">// true</span></div><div class="line">        log.info(String.valueOf(amount)); <span class="comment">// 100</span></div><div class="line">        log.info(<span class="string">"=========ANTI========="</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>일반적으로 가장 쉬운 Environment를 활용한 방법입니다. 많은 것들 생각하지 않고 properties에 정의된 것을 key 값으로 찾아옵니다.</p><p>위의 Environment 이용해서 properties에서 설정을 가져오는 것은 편하지만 단점들이 있습니다.</p><h3><span id="정확한-자료형-확인의-어려움">정확한 자료형 확인의 어려움</span></h3><p>key 값으로 어느 정도 유추할 수 있지만 어디까지나 유추이지 정확한 자료형을 확인하기 위해서는 properties에서 value 값을 기반으로 자료형을 확인해야 합니다. 또 amount 값이 100 이기 때문에 int 타입으로 바인딩시켰지만 amount 값은 소수로 값이 변경될 수도 있습니다. 이 또한 값을 통해서 자료형을 유추했기 때문에 발생한다고 생각합니다.</p><h3><span id="변경시-관리의-어려움">변경시 관리의 어려움</span></h3><p>email의 키값이 email-address로 변경됐을시 getProperty() 메서드를 통해서 바인딩 시킨 부분들은 모두 email-address로 변경해야 합니다. 변경하는 것도 문제지만 만약 1개의 메소드라도 실수로 놓쳤을 경우 에러 발생 시점에 runtime으로 넘어가게 되고 해당 에러가 NullPointException이 발생하기 전까지는 확인하기 어렵습니다.</p><h2><span id="추천-패턴-configurationproperties">추천 패턴 : ConfigurationProperties</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Configuration</span></div><div class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"user"</span>)</div><div class="line"><span class="meta">@Validated</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SampleProperties</span> </span>&#123;</div><div class="line">    <span class="meta">@Email</span></div><div class="line">    <span class="keyword">private</span> String email;</div><div class="line">    <span class="meta">@NotEmpty</span></div><div class="line">    <span class="keyword">private</span> String nickname;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> auth;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">double</span> amount;</div><div class="line"></div><div class="line">    <span class="comment">// getter, setter</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SamplePropertiesRunner</span> <span class="keyword">implements</span> <span class="title">ApplicationRunner</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SampleProperties properties;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(ApplicationArguments args)</span>  </span>&#123;</div><div class="line">        <span class="keyword">final</span> String email = properties.getEmail();</div><div class="line">        <span class="keyword">final</span> String nickname = properties.getNickname();</div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> age = properties.getAge();</div><div class="line">        <span class="keyword">final</span> <span class="keyword">boolean</span> auth = properties.isAuth();</div><div class="line">        <span class="keyword">final</span> <span class="keyword">double</span> amount = properties.getAmount();</div><div class="line"></div><div class="line">        log.info(<span class="string">"=================="</span>);</div><div class="line">        log.info(email); <span class="comment">// yun@test.com</span></div><div class="line">        log.info(nickname); <span class="comment">// yun</span></div><div class="line">        log.info(String.valueOf(age)); <span class="comment">// 27</span></div><div class="line">        log.info(String.valueOf(auth)); <span class="comment">// true</span></div><div class="line">        log.info(String.valueOf(amount)); <span class="comment">// 100.0</span></div><div class="line">        log.info(<span class="string">"=================="</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>아주 간단하고 명확한 해결 방법은 ConfigurationProperties를 이용해서 POJO 객체를 두는 것입니다. 장점들은 다음과 같습니다.</p><h3><span id="validation">Validation</span></h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="attr">user:</span></div><div class="line"><span class="attr">  email:</span> <span class="string">"yun@"</span> <span class="string">//</span> <span class="string">이메일</span> <span class="string">형식</span> <span class="string">올바르지</span> <span class="string">않음</span> <span class="bullet">-&gt;</span> <span class="string">@Email</span></div><div class="line"><span class="attr">  nickname:</span> <span class="string">""</span> <span class="string">//</span> <span class="string">필수</span> <span class="string">값</span> <span class="bullet">-&gt;</span> <span class="string">@NotEmpty</span></div></pre></td></tr></table></figure><p>JSR-303 기반으로 Validate 검사를 할 수 있습니다. 위 코드 처럼 <code>@Validated</code>, <code>@Email</code> 어노테이션을 이용하면 쉽게 유효성 검사를 할 수 있습니다.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Binding to target com.cheese.springjpa.properties.SampleProperties$<span class="variable">$EnhancerBySpringCGLIB</span>$<span class="variable">$68016904</span>@3cc27db9 failed:</div><div class="line"></div><div class="line">    Property: user.email</div><div class="line">    Value: yun@</div><div class="line">    Reason: 이메일 주소가 유효하지 않습니다.</div><div class="line"></div><div class="line">Binding to target com.cheese.springjpa.properties.SampleProperties$<span class="variable">$EnhancerBySpringCGLIB</span>$<span class="variable">$d2899f85</span>@3ca58cc8 failed:</div><div class="line"></div><div class="line">    Property: user.nickname</div><div class="line">    Value: </div><div class="line">    Reason: 반드시 값이 존재하고 길이 혹은 크기가 0보다 커야 합니다.</div></pre></td></tr></table></figure><p><strong>위와 같이 컴파일 과정 중에 잡아주고 에러 메시지도 상당히 구체적입니다.</strong></p><h3><span id="빈으로-등록-해서-재사용성이-높음">빈으로 등록 해서 재사용성이 높음</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SampleProperties</span> </span>&#123;</div><div class="line">    <span class="meta">@Email</span></div><div class="line">    <span class="keyword">private</span> String email;</div><div class="line">    <span class="meta">@NotEmpty</span></div><div class="line">    <span class="keyword">private</span> String nickname;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> auth;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">double</span> amount;</div><div class="line"></div><div class="line">    <span class="comment">// getter, setter </span></div><div class="line">    <span class="comment">// properties 사용할 떄는 SampleProperties 객체를 사용함, 데이터의 응집력, 캡슐화가 높아짐</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><p>SamplePropertiesRunner 클래스를 보시면 SampleProperties를 의존성 주입을 받아서 다른 빈에서 재사용성이 높습니다. 단순히 재사용성이 높은 것이 아니라 user의 응집력이 높아집니다.</p><p>개별적으로 user에 대한 데이터 email, nickname, age…를 나열하는 것은 응집력을 심각하게 떨어트린다고 생각합니다. user가 가지고 있는 정보들은 또 무엇인지 확인 하기 어렵고 정확한 타입을 유추하기도 어렵습니다. 이로 인해서 캡슐화의 심각한 저하로 이어 집니다…</p><h3><span id="그밖에-장점들">그밖에 장점들</span></h3><p>Relaxed Binding으로 properties 키값에 유연하게 지정할 수 있습니다.</p><p>SampleProperties에 firstName 추가되었을 때 바인딩시킬 properties 키값을 first-name, FIRSTNAME, firstName 등을 사용해도 바인딩이 됩니다. 장점이긴 하지만 반드시 하나의 네이밍을 정하고 통일하는 게 바람직하다고 생각합니다.</p><h2><span id="결론">결론</span></h2><p><strong>위에서 설명한 부분을 properties의 한에서만 생각하지 않고 객체를 바라볼 때 데이터의 응집력, 캡슐화를 높이는 방법을 고민하는 것이 중요하다고 생각합니다.</strong></p><h2><span id="참고-자료">참고 자료</span></h2><ul><li><a href="https://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/htmlsingle/" rel="external nofollow noopener noreferrer" target="_blank">Spring Boot Reference Guide</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;해당 코드는 &lt;a href=&quot;https://github.com/cheese10yun/spring-jpa-best-practices&quot; rel=&quot;external nofollow noopener noreferrer&quot; target=&quot;_blank&quot;&gt;Git
      
    
    </summary>
    
    
      <category term="Spring" scheme="https://cheese10yun.github.io/tags/Spring/"/>
    
      <category term="JPA" scheme="https://cheese10yun.github.io/tags/JPA/"/>
    
      <category term="Best Practices" scheme="https://cheese10yun.github.io/tags/Best-Practices/"/>
    
  </entry>
  
  <entry>
    <title>인텔리제이 Properties 자동완성</title>
    <link href="https://cheese10yun.github.io/intellij-Assistant/"/>
    <id>https://cheese10yun.github.io/intellij-Assistant/</id>
    <published>2018-08-04T15:00:00.000Z</published>
    <updated>2018-08-05T05:30:45.148Z</updated>
    
    <content type="html"><![CDATA[<p align="center">    <img src="https://i.imgur.com/X6giEx5.gif"> </p><p>위 그림처럼 유자가 추가한 properties 속성들도 자동 완성을 지원합니다.</p><p align="center">    <img src="https://i.imgur.com/AmkyrnX.gif"> </p><p>또 Properties 속성이 코드에 바인딩 되는지 확인 할 수 있어 아주 유용합니다.</p><h2><span id="properties">Properties</span></h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="attr">sample:</span></div><div class="line"><span class="attr">  email:</span> <span class="string">"yun@test.com"</span></div><div class="line">  <span class="string">name</span> <span class="string">:</span> <span class="string">"yun"</span></div><div class="line"><span class="attr">  age:</span> <span class="number">27</span></div><div class="line"><span class="attr">  auth:</span> <span class="literal">true</span></div></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Configuration</span></div><div class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"sample"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SampleProperties</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> String email;</div><div class="line">    <span class="keyword">private</span> String name;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> auth;</div><div class="line"></div><div class="line">    <span class="comment">// getter, setter </span></div><div class="line">&#125;</div></pre></td></tr></table></figure><p>Properties 속성값과 바인딩 될 객체입니다.</p><h2><span id="plugin-추가">Plugin 추가</span></h2><p align="center">    <img src="https://i.imgur.com/rVX7XJz.png"> </p><p><strong>대부분 이미 설치가 되어있을 겁니다.</strong></p><h2><span id="의존성-추가">의존성 추가</span></h2><h3><span id="maven">maven</span></h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure><h3><span id="gradle">gradle</span></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">dependencies &#123;</div><div class="line">    optional &quot;org.springframework.boot:spring-boot-configuration-processor&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2><span id="intellij-설정">Intellij 설정</span></h2><p align="center">    <img src="https://i.imgur.com/Gojvv1c.png"> </p><p><code>Settings &gt; Build, Execution &amp; Deployment &gt; Compiler &gt; Annotation Processors</code> 에서 <code>Enable annotation processing</code>를 체크</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p align=&quot;center&quot;&gt;
    &lt;img src=&quot;https://i.imgur.com/X6giEx5.gif&quot;&gt; 
&lt;/p&gt;
&lt;p&gt;위 그림처럼 유자가 추가한 properties 속성들도 자동 완성을 지원합니다.&lt;/p&gt;
&lt;p align=&quot;cente
      
    
    </summary>
    
    
      <category term="IntelliJ" scheme="https://cheese10yun.github.io/tags/IntelliJ/"/>
    
      <category term="Properties" scheme="https://cheese10yun.github.io/tags/Properties/"/>
    
      <category term="Assistant" scheme="https://cheese10yun.github.io/tags/Assistant/"/>
    
  </entry>
  
  <entry>
    <title>Spring 예제로 보는 SOLID DIP</title>
    <link href="https://cheese10yun.github.io/spring-solid-dip/"/>
    <id>https://cheese10yun.github.io/spring-solid-dip/</id>
    <published>2018-07-26T15:00:00.000Z</published>
    <updated>2018-07-26T15:24:55.270Z</updated>
    
    <content type="html"><![CDATA[<p>해당 코드는 <a href="https://github.com/cheese10yun/spring-SOLID" rel="external nofollow noopener noreferrer" target="_blank">Github</a>를 확인해주세요.</p><p>의존성역전의 원칙: Dependency Inversion Principle의 핵심 키워드는 다음과 같습니다.</p><p>상위 수준 정책은 하위 수준 세부 정보에 의존해서는 안됩니다.</p><ul><li>상위 모듈은 하위 모듈의 구현에 의존해서는 안 된다.</li><li>하위의 모듈이 상위 모듈에 정의한 추상 타입에 의존 해야한다.</li></ul><p>대표적인 DIP 핵심 키워드 입니다. 단어 하나 하나 플이를 하고 아래의 예제를 통해서 다 다시 이해하는 과정을 통해서 설명드리겠습니다. 다음예제는 아래와 같은 요구사항이 있습니다.</p><h1><span id="요구사항">요구사항</span></h1><ul><li>카드 결제 시스템을 만들어야 한다.</li><li>현재 지원하는 카드는 신한 카드 하나뿐이다.</li><li>이제 우리 카드 결제가 추가되어 구현해야 한다.</li><li>앞으로도 카드는 지속해서 추가될 예정이다.</li></ul><h1><span id="용어-풀이">용어 풀이</span></h1><blockquote><p><strong><em>상위 모듈 이란 ?</em></strong></p><p>상위 모듈이란 상위 정책을 의미합니다. 위의 요구사항에서는 카드 결제라는 것이 상위 정책을 뜻합니다.</p></blockquote><blockquote><p><strong><em>하위 모듈 이란 ?</em></strong></p><p>하위 모듈이란 상위 정책에 따른 하위 정책을 말합니다. 위의 요구사항에서 카드 결제라는 상위 정책이 있으면 신한 카드 결제라는 하위(세부) 정책이 있습니다.</p></blockquote><blockquote><p><strong><em>추상 타입 이란 ?</em></strong></p><p>추상 타입은 인터페이스, 추상화 클래스를 의미합니다. 상위 정책이 하위 정책에 의존하지 않고 추상 타입에 의존하라는 것은 <strong>카드 결제라는 상위 정책이 신한 카드 결제라는 하위 정책을 의존하지 말고 추상 클래스, 인터페이스를 의존하라는 것입니다.</strong></p></blockquote><h1><span id="dip-준수하지-않은-코드">DIP 준수하지 않은 코드</span></h1><p align="center">    <img src="https://i.imgur.com/Zkykv9m.png"></p><p><strong>위 그림은 쉽게 설명해보면 카드 결제(상위 수준 정책)가 신한 카드 결제(하위 수준)에 의존하고 있습니다.</strong> 그렇다면 이것이 갖는 단점이 무엇인지 아래 예제 코드를 통해서 확인해보겠습니다.</p><h2><span id="지나친-의존-관계">지나친 의존 관계</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PaymentController</span> </span>&#123;</div><div class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/dip/anti/payment"</span>, method = RequestMethod.POST)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pay</span><span class="params">(@RequestBody ShinhanCardDto.PaymentRequest req)</span></span>&#123;</div><div class="line">        shinhanCardPaymentService.pay(req);</div><div class="line">    &#125;   </div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ShinhanCardPaymentService</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pay</span><span class="params">(ShinhanCardDto.PaymentRequest req)</span> </span>&#123;</div><div class="line">        shinhanCardApi.pay(req);</div><div class="line">    &#125;   </div><div class="line">&#125;</div></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// RequestBody JSON 포멧</div><div class="line">&#123;</div><div class="line">  "shinhanCardNumber":"4845-9005-9423-4452",  //만약 shinhanCardNumber -&gt; cardNumber 으로 변경된다면 ?</div><div class="line">  "cvc":"233"</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>카드 결제 기능(상위 정책)이 신한 카드 결제(하위 정책)에 지나치게 의존적입니다. 그 결과 위처럼 신한 카드사의 카드 결제의 JSON의 키값만 변경 시 컨트롤러, 또 그 값을 넘겨주는 프론트엔드 까지 변경까지 영향을 미치게 됩니다. 이렇듯 지나친 의존 관계는 많은 변경 포인트를 유발합니다.</p><h2><span id="확장에-유연하지-못함">확장에 유연하지 못함</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/anti/payment"</span>, method = RequestMethod.POST)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pay</span><span class="params">(@RequestBody CardPaymentDto.PaymentRequest req)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span>(req.getType() == CardType.SHINHAN)&#123;</div><div class="line">        shinhanCardPaymentService.pay(req);</div><div class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(req.getType() == CardType.WOORI)&#123;</div><div class="line">        wooriCardPaymentService.pay(req);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>우리 카드, 신한 카드 결제 요청을 받을 PaymentRequest Dto 클래스를 생성하였고 CardType으로 해당 맞는 카드 타입에 맞는 서비스를 호출하는 구조입니다. 가장 쉽게 생각할 수 있는 구조이지만 결코 좋은 구조가 아닙니다. 카드가 지속해서 추가될 때마다 해당 카드결제를 위한 if 문을 지속해서 추가해야 합니다. 이런 반복적인 if는 해당 리팩토링 대상일 확률이 매우 높습니다.</p><p>그 밖에도 추가될 카드의 결제를 담당하는 XXXPaymentService 클래스들이 지속해서 의존성 이루어집니다. 그 결과 PaymentController는 컨트롤러 계층임에도 너무 많은 책임을 갖게 되며, <strong>확장에 어렵고, 변경에 취약한 구조가 됩니다.</strong> 이 설명은 <a href="https://github.com/cheese10yun/spring-SOLID/blob/master/docs/OCP.md" rel="external nofollow noopener noreferrer" target="_blank">개방 폐쇄의 원칙: Open Close Principle</a>에서도 언급했던 내용입니다. 이렇듯 DIP와 OCP는 연관이 크며 SOLID도 각기 다른 메커니즘이 아니라 서로 유기적으로 연결되어 있습니다.</p><h1><span id="dip-준수">DIP 준수</span></h1><p align="center">    <img src="https://i.imgur.com/TdGYl8n.png"></p><ul><li>상위 모듈은 하위 모듈의 구현에 의존해서는 안 된다. 하위의 모듈이 상위 모듈에 정의한 추상 타입에 의존 해야한다.</li></ul><p>DIP의 핵심 내용이 문장장을 위의 요구사항에 맞춰서 풀어 보겠습니다.</p><p><strong>카드 결제(상위 모듈은)는 신한 카드 결제(하위 모듈)에 의존해서는 안된다. 신한 카드 결제(하위 모듈)은 카드 결제(상위 모듈)에 정의한 카드 결제 인터페이스(추상 타입)에 의존 해야한다.</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PaymentController</span> </span>&#123;</div><div class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/payment"</span>, method = RequestMethod.POST)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pay</span><span class="params">(@RequestBody CardPaymentDto.PaymentRequest req)</span> </span>&#123;</div><div class="line">        <span class="keyword">final</span> CardPaymentService cardPaymentService = cardPaymentFactory.getType(req.getType());</div><div class="line">        cardPaymentService.pay(req);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CardPaymentService</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pay</span><span class="params">(CardPaymentDto.PaymentRequest req)</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShinhanCardPaymentService</span> <span class="keyword">implements</span> <span class="title">CardPaymentService</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pay</span><span class="params">(CardPaymentDto.PaymentRequest req)</span> </span>&#123;</div><div class="line">        shinhanCardApi.pay(req);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>이제 코드 레벨에서 다시 정리해 보겠습니다. 의존관계를 인터페이스를 통해서 의존성을 역전 시켰습니다. 컴파일 단계에서는 PaymentController는 PaymentService 인터페이스를 바라보지만 런타임에서는 cardPaymentFactory 통해서 ShinhanCardPaymentService를 바라보게 됩니다.</p><p>또 하위 정책의 신한 카드, 우리 카드가 변경되더라도 PaymenrService 인터페이스를 의존하고 있으므로 확장에 열려 있고 변경에는 닫혀 있는 OCP를 준수하게 됩니다.</p><h1><span id="결론">결론</span></h1><p>그렇다면 모든 곳에 대해서 세부 구현체를 바라보는 것이 아니라 인터페이스로 바라보는 것이 올바른 것일까요? <strong>제 개인적인 생각은 그렇지 않다 입니다.</strong></p><p>모든 변경사항에 대응해서 설계한다는 것은 현실적으로 힘듭니다. 위 요구 사항처럼 지속해서 결제 가능한 카드사가 추가된다는 요구사항, 경험을 통해서 예측할 수 있는 상황들에 적용하는 것이 바람직하다고 생각합니다.</p><p>또 개인적인 생각으로는 인프라스트럭처에 대해서는 인터페이스로 바라보는 것이 적절하다고 생각합니다. 인프라스트럭처는 언제든지 대체될 수 있는 영역이기 때문에 이런 영역에 대해서는 인터페이스로 바라보게 설계해서 의존성을 역전 시키는 것이 좋을 거 같습니다.</p><h1><span id="참고">참고</span></h1><ul><li><a href="http://www.kyobobook.co.kr/product/detailViewKor.laf?ejkGb=KOR&amp;barcode=9788969090010" rel="external nofollow noopener noreferrer" target="_blank">도서 - 개발자가 반드시 정복해야 할 객체 지향과 디자인 패턴</a></li><li><a href="https://www.youtube.com/user/codetemplate/videos" rel="external nofollow noopener noreferrer" target="_blank">Youtube 강의(백명석님)</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;해당 코드는 &lt;a href=&quot;https://github.com/cheese10yun/spring-SOLID&quot; rel=&quot;external nofollow noopener noreferrer&quot; target=&quot;_blank&quot;&gt;Github&lt;/a&gt;를 확인해주
      
    
    </summary>
    
    
      <category term="Spring" scheme="https://cheese10yun.github.io/tags/Spring/"/>
    
      <category term="SOLID" scheme="https://cheese10yun.github.io/tags/SOLID/"/>
    
      <category term="DIP" scheme="https://cheese10yun.github.io/tags/DIP/"/>
    
  </entry>
  
  <entry>
    <title>Spring 예제로 보는 SOLID OCP</title>
    <link href="https://cheese10yun.github.io/spring-solid-ocp/"/>
    <id>https://cheese10yun.github.io/spring-solid-ocp/</id>
    <published>2018-07-23T15:00:00.000Z</published>
    <updated>2018-07-24T16:30:15.685Z</updated>
    
    <content type="html"><![CDATA[<p>해당 코드는 <a href="https://github.com/cheese10yun/spring-SOLID" rel="external nofollow noopener noreferrer" target="_blank">Github</a>를 확인해주세요.</p><h1><span id="개방-폐쇄의-원칙-open-close-principle">개방 폐쇄의 원칙: Open Close Principle</span></h1><p>개방 폐쇄의 원칙: Open Close Principle 핵심 키워드는 다음과 같습니다. 해당 키워드를 기반으로 세부적으로 설명하겠습니다.</p><ul><li><strong>확장에는 열려 있고, 변경에는 닫혀 있다.</strong></li><li><strong>기능을 추가하거나 변경하면서 그것을 사용하는 코드는 수정하지 않는다.</strong></li></ul><p>대표적인 OCP의 핵심 개념입니다. SOLID를 처음 접하는 분들은 다소 어렵게 느껴지는 것들을 최대한 쉽게 풀어보겠습니다.</p><h2><span id="용어-정리">용어 정리</span></h2><blockquote><p><strong>확장 이란 ?</strong></p><p>새로운 타입을 추가함으로써 새로운 기능을 추가할 수 있다. 즉 확장이란 새로운 타입을 추가함으로써 새로운 기능(요구사항)을 구현한다. <strong>확장에는 열려 있다는 것은 새로운 타입(클래스)을 추가함으로써 기능(요구사항)을 확장하는 것이다…</strong></p></blockquote><blockquote><p><strong>변경 이란 ?</strong></p><p>확장이 발생했을 때 상위 레벨이 영향을 미치지 않아야 한다. <strong>확장(새로운 클래스)이 발생했을 때 해당 코드를 호출하는 쪽에서 변경이 발생하지 않다면 변경에 닫혀 있다는 것이다.</strong></p></blockquote><h1><span id="요구사항">요구사항</span></h1><ul><li>카드 결제 시스템을 만들어야 한다.</li><li>현재 지원하는 카드는 신한 카드 하나뿐이다.</li><li>이제 우리 카드 결제가 추가되어 구현해야 한다.</li><li>앞으로도 카드는 지속해서 추가될 예정이다.</li></ul><h1><span id="ocp를-준수하기-위한-실패-과정들">OCP를 준수하기 위한 실패 과정들</span></h1><p align="center">    <img src="https://i.imgur.com/a21midG.png"></p><p>기존 PamentController에서 ShinhanCardPaymentService를 의존해서 신한 카드 결제를 진행 헸습니다. 이제 우리 은행 카드결제가 추가되었으니 아래 컨트롤러처럼 기존 신한 카드를 건드리지(변경에 닫혀있다) 않고 우리 카드를 추가하는 가장 쉬운 방법은 아래처럼 컨트롤러를 각각 구성하는 방법입니다. 물론 OCP를 위반하는 코드입니다.</p><h2><span id="카드사-마다-api">카드사 마다 API</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/ocp/anti/payment/shinhan"</span>, method = RequestMethod.POST)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pay</span><span class="params">(@RequestBody ShinhanCardDto.PaymentRequest req)</span></span>&#123;</div><div class="line">    shinhanCardPaymentService.pay(req);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/ocp/anti/payment/woori"</span>, method = RequestMethod.POST)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pay</span><span class="params">(@RequestBody WooriCardDto.PaymentRequest req)</span></span>&#123;</div><div class="line">    wooriCardPaymentService.pay(req);</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>해당 구조는 매우 좋지 않습니다. 카드사가 추가될 때 마다 API를 추가적으로 만들어야 합니다. 이는 확장에 좋지 않은 코드 뿐만 아니라 올바른 카드사의 API를 찾기위한 코드가 필요하게 됩니다.</p><h2><span id="공통-request로-api-통일">공통 Request로 API 통일</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentRequest</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> String cardNumber;</div><div class="line">    <span class="keyword">private</span> String csv;</div><div class="line">    <span class="keyword">private</span> CardType type;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 컨트롤러</span></div><div class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/ocp/anti/payment"</span>, method = RequestMethod.POST)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pay</span><span class="params">(@RequestBody CardPaymentDto.PaymentRequest req)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span>(req.getType() == CardType.SHINHAN)&#123;</div><div class="line">        shinhanCardPaymentService.pay(req);</div><div class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(req.getType() == CardType.WOORI)&#123;</div><div class="line">        wooriCardPaymentService.pay(req);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 그 해당 카드 이외의 타입이 들어오면 예외처리는 어떻게??...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><p>넘겨받는 RequestBody 값의 통일로 하나의 API에서 신한 카드, 우리 카드 결제를 진행할 수 있게 되었습니다. 예를 들어 신한 카드는 카드 번호를 shinhanCardNumber, 우리 카드는 number로 사용했을 경우 매번 미세하게 다른 값들을 공통 Request로 통일하게 됩니다. 다음과 같은 장점이 같을 수 있습니다.</p><ul><li>기존 코드는 카드 파트너사의 API Request에 의존 관계를 분리할 수 있습니다.<ul><li>DIP의 '상위 레벨의 정책은 하위 레벨의 상세 합에 의존하면 안 된다.'를 준수하게 됩니다. (해당 개념은 DIP에 자세하게 포스팅하겠습니다.)</li></ul></li><li>Request 값을 통일 함으로써 추상화의 기초가 됩니다.</li></ul><p>위의 코드는 OCP를 준수하지는 않습니다. <strong>위에서 정리한 용어 변경에 위배됩니다.</strong></p><blockquote><p>확장(새로운 클래스)이 발생했을 때 해당 코드를 호출하는 쪽에서 <strong>변경이 발생하지 않다면</strong> 변경에 닫혀 있다는 것입니다.</p></blockquote><p>우리 카드가 추가되었을 경우 해당 컨트롤러의 코드에 if이 추가되었습니다. 이는 위에서 정리한 변경이 발생하는 경우입니다. 또 한 카드가 지속해서 추가될 때 마다 해당 카드결제를 위한 if 문을 지속해서 추가해야 합니다. 이런 반복적인 if는 해당 리팩토링 대상일 확률이 매우 높습니다.</p><p>그 밖에도 추가될 카드의 결제를 담당하는 XXXPaymentService 클래스들이 지속해서 의존성 이루어집니다. 그 결과 PaymentController는 컨트롤러 계층임에도 너무 많은 책임을 갖게 되며, <strong>확장에 어렵고, 변경에 취약한 구조가 됩니다.</strong></p><h1><span id="ocp-준수">OCP 준수</span></h1><p align="center">    <img src="https://i.imgur.com/TdGYl8n.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentController</span> </span>&#123;</div><div class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/payment"</span>, method = RequestMethod.POST)</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pay</span><span class="params">(@RequestBody CardPaymentDto.PaymentRequest req)</span> </span>&#123;</div><div class="line">        <span class="keyword">final</span> CardPaymentService cardPaymentService = cardPaymentFactory.getType(req.getType());</div><div class="line">        cardPaymentService.pay(req);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShinhanCardPaymentService</span> <span class="keyword">implements</span> <span class="title">CardPaymentService</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pay</span><span class="params">(CardPaymentDto.PaymentRequest req)</span> </span>&#123;</div><div class="line">        <span class="keyword">final</span> ShinhanCardDto.PaymentRequest paymentRequest = buildPayment(req);</div><div class="line">        shinhanCardApi.pay(paymentRequest);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WooriCardPaymentService</span> <span class="keyword">implements</span> <span class="title">CardPaymentService</span> </span>&#123;    </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pay</span><span class="params">(CardPaymentDto.PaymentRequest req)</span> </span>&#123;</div><div class="line">        <span class="keyword">final</span> WooriCardDto.PaymentRequest paymentRequest = buildPayment(req);</div><div class="line">        wooriCardApi.pay(paymentRequest);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>의존관계를 인터페이스를 통해서 역전시키는 것입니다. <strong>새로운 카드 결제가 추가된다고 하더라도 PaymentController 수정 없이 CardPayment를 확장하고 있습니다.</strong></p><p>다시 한번 정리하면 <strong>새로운 카드 결제가 추가(새로운 결제 타입 추가) 되더라도(확장에 열려있음) 카드 결제를 호출하는 코드 쪽에서 변경이(변경에는 닫혀 있음) 변경이 발생하지 않습니다. 물론 cardPaymentFactory 클래스의 의존성 주입 코드가 한번은 추가됩니다.</strong></p><p>즉 우리 카드 결제라는 새로운 기능이 추가되었을 때 이것을 새로운 타입으로 추가해서 런타임시 교체하여 <strong>확장에는 열려 있고</strong>, 또 그 코드를 호출하는 쪽은 인터페이스를 바라보고 있으므로 <strong>변경에는 닫혀 있는</strong> 구조가 됩니다.</p><p>이처럼 인터페이스를 두는 것만 해도 클래스 간의 강한 결합 관계를 느슨한 관계로 만들 수 있습니다. 그렇다면 모든 클래스의 결합 관계를 인터페이스를 두고 느슨한 관계로 유지해야 하는 걸까요?</p><p><strong>제 개인적인 생각은 아니라고 생각합니다.</strong> 모든 변경사항을 예상하는 것은 불가능하며 그것을 하는 것 또한 지나치게 비효율적이라고 생각합니다. 위처럼 명확한 요구사항인 지속해서 카드 결제가 추가되어야 한다. 라는 명확한 변경이 예상되는 시점, 경험을 통해서 예측할 수 있는 시점에 적용하는 것이 바람직하다고 생각합니다.</p><p><strong>그렇다면 중요한 것은 캡슐화, 객체의 올바른 책임, 역할을 부여하여 예측 변경 시점에 OCP를 쉽게 적용할 수 있도록 하는 것이 중요하다고 생각합니다.</strong></p><h1><span id="참고">참고</span></h1><ul><li><a href="http://www.kyobobook.co.kr/product/detailViewKor.laf?ejkGb=KOR&amp;barcode=9788969090010" rel="external nofollow noopener noreferrer" target="_blank">도서 - 개발자가 반드시 정복해야 할 객체 지향과 디자인 패턴</a></li><li><a href="https://www.youtube.com/user/codetemplate/videos" rel="external nofollow noopener noreferrer" target="_blank">Youtube 강의(백명석님)</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;해당 코드는 &lt;a href=&quot;https://github.com/cheese10yun/spring-SOLID&quot; rel=&quot;external nofollow noopener noreferrer&quot; target=&quot;_blank&quot;&gt;Github&lt;/a&gt;를 확인해주
      
    
    </summary>
    
    
      <category term="Spring" scheme="https://cheese10yun.github.io/tags/Spring/"/>
    
      <category term="SOLID" scheme="https://cheese10yun.github.io/tags/SOLID/"/>
    
      <category term="OCP" scheme="https://cheese10yun.github.io/tags/OCP/"/>
    
  </entry>
  
  <entry>
    <title>인텔리제이 GitHub 활용법</title>
    <link href="https://cheese10yun.github.io/intellij-github/"/>
    <id>https://cheese10yun.github.io/intellij-github/</id>
    <published>2018-07-17T15:00:00.000Z</published>
    <updated>2018-07-18T14:05:30.601Z</updated>
    
    <content type="html"><![CDATA[<p>IntelliJ에서 다양한 Github 기능들을 제공해줍니다. 그 대표적인 기능들에 대한 정리입니다. 단축키는 하단 녹색박스에 표시되어 있습니다.</p><h2><span id="github-아이디-연동">Github 아이디 연동</span></h2><p>인텔리제이에서 지원하는 다양한 기능들을 사용하기 위해서는 Github 연동이 반드시 필요 합니다.</p><p><img src="https://i.imgur.com/wdn4bEW.png" alt=""></p><ol><li>설정에서 github 텝 인동</li><li>해당 Auth Type 선택 후 Test 버튼 클릭</li><li>Success 출력 확인후 OK 버튼 클릭</li></ol><h2><span id="share-proejct">Share Proejct</span></h2><p align="center">    <img src="https://github.com/cheese10yun/IntelliJ/blob/master/image/github-share.gif?raw=true"></p><p>해당 프로젝트를 GitHub Repository에 쉽게 업로드 할 수 있습니다.</p><h2><span id="gist-올리기">Gist 올리기</span></h2><p align="center">  <img src="https://github.com/cheese10yun/IntelliJ/blob/master/image/gist.gif?raw=true"></p>![](https://i.imgur.com/8XoRPgf.png)<p>원하는 코드를 드래그하고 위 그림처럼 Gist를 편하게 업로드 할 수 있습니다.</p><h2><span id="task-연동">Task 연동</span></h2><p><img src="https://i.imgur.com/qiDODzI.png" alt=""></p><p>Github Repository에 등록된 이슈들 기반으로 Branch를 생성 할 수있습니다. 세부 적인 워크 플로우는 <a href="https://github.com/cheese10yun/github-project-management" rel="external nofollow noopener noreferrer" target="_blank">Github로 프로젝트 관리하기</a>에서 확인 할 수 있습니다.</p><h3><span id="taskissue-기반-branch-생성">Task(Issue) 기반 Branch 생성</span></h3><p align="center">  <img src="https://github.com/cheese10yun/IntelliJ/blob/master/image/task.gif?raw=true"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;IntelliJ에서 다양한 Github 기능들을 제공해줍니다. 그 대표적인 기능들에 대한 정리입니다. 단축키는 하단 녹색박스에 표시되어 있습니다.&lt;/p&gt;
&lt;h2&gt;&lt;span id=&quot;github-아이디-연동&quot;&gt;Github 아이디 연동&lt;/span&gt;&lt;/
      
    
    </summary>
    
    
      <category term="IntelliJ" scheme="https://cheese10yun.github.io/tags/IntelliJ/"/>
    
      <category term="Tip" scheme="https://cheese10yun.github.io/tags/Tip/"/>
    
      <category term="Git" scheme="https://cheese10yun.github.io/tags/Git/"/>
    
  </entry>
  
  <entry>
    <title>Github로 프로젝트 관리하기 Part3</title>
    <link href="https://cheese10yun.github.io/github-project-part3/"/>
    <id>https://cheese10yun.github.io/github-project-part3/</id>
    <published>2018-07-16T15:00:00.000Z</published>
    <updated>2018-07-17T13:53:55.186Z</updated>
    
    <content type="html"><![CDATA[<h2><span id="프로젝트-소개">프로젝트 소개</span></h2><p>Github를 이용해서 Project Management 하는 방법 및 전체적인 프로세스에 대해서 정리했습니다. <strong>issue 관리, 일정 관리, 코드리뷰, 버그 리포트 등 다양한 일들을 Github 하나에서 다 관리할 수 있고 어느 하나 부족하다고 생각하지 않습니다.</strong> 이미 Remote Repository로 Github를 사용 중 이리 사면 적극 추천해 드립니다.</p><p><img src="https://i.imgur.com/F5c78MC.png" alt=""></p><p>수 많은 이슈들이 발급되면 그것을 한눈에 보는 것은 기존 UI에서는 어렵습니다. 이런 문제를 칸반보드 형식으로 해결해주는 것이 ZenHub 입니다.</p><p><img src="https://cristinasantamarina.files.wordpress.com/2015/06/zenhub-task-board.png" alt=""><br>Public Repository를 이용 중이라면 무료로 사용 가능합니다. Private Repository는 비용을 지급하셔 야합니다.</p><p>물론 GitHub에서 제공해주는 Proeject도 칸반보드를 제공해주어서 대안이 되지만 여러 레파지토리에 대한 표시, 애픽 기능 등 다양한 기능들을 제공해주기 때문에 개인적으로 ZenHub를 추천해 드립니다.</p><p><strong>설치는 크롬 확장도구에서 다운로드 받으실 수 있습니다.</strong></p><h2><span id="기본-칸반보드">기본 칸반보드</span></h2><p>기본적인 구조는 New Issue, Icebox, Backlog, In Progress, Review/QA, Done을 갖습니다.</p><p>각자 본인의 프로젝트와 성향에 맞게 사용하시면 됩니다. 저 같은 경우에는 생각나는 모든 것들을 New Issue 항목에 추가하고 우선순위가 낮고 당장 필요 없는 작업은 Icebox, 우선순위가 높은 작업은 Backlog 항목에 넣습니다. 진행 중인 작업은 In Progress 나머지 Review/QA는 Pull Request 항목, Done은 Issue가 Close 되면 자동으로 Done으로 가게 됩니다.</p><p><strong>이처럼 모든 항목에 대해서 Issue로 관리하고 해당 Issue Number 기반으로 Branch가 생성되면서 코드리뷰, 반영 작업 사이클이 돌아가는 구조입니다.</strong></p><h2><span id="milestone-적극-활용">Milestone 적극 활용</span></h2><p><img src="https://i.imgur.com/3lDuAxi.png" alt=""></p><p>ZenHub 사용과 직접적인 기능은 아니지만, Milestone 여러 항목을 만들고 대부분 Icebox에 있는 issue가 아니라면 적절한 Milestone에 위치시키는 것을 권장합니다. 전체적인 작업에 진행 척도를 가시적으로 확인하기 좋은 점, 해당 Milestone(버전)에 추가되는 기능, 강화되는 기능, 수정된 버그 등을 직관적이로 표시 할 수 있습니다. 또 전체 Milestone 진척도를 알 수 있어 남은 시간도 산출하기 좋은 장점이 있습니다.</p><h2><span id="epic-적극-활용">Epic 적극 활용</span></h2><p><img src="https://i.imgur.com/dZhrATb.png" alt=""><br>Epic은 Milestone과 비슷하게 이해하시면 됩니다. 큰 작업(Issue)이 있다면 그 작업(Issue)을 여러 Issue로 등록하고 한 묶음으로 관리하는 것입니다.</p><p>Milestone의 장점처럼 작업에 대한 진척도를 가시적으로 표시하는 장점이 있습니다. 또 큰 작업물에 대한 작업은 여러 개발자가 나누어서 하다 보니 내가 그 기능을 작업하기 전에 선행적으로 진행되어야 하는 작업도 있을 수 있습니다. 이런 것들을 대한 피드백을 Epic을 이용하면 관리하기 편합니다.</p><p><img src="https://i.imgur.com/nIMGciB.png" alt=""><br>해당 Issue를 Epic으로 등록 시킬 경우 Create an epic 버튼을 클릭하면 됩니다.</p><p><img src="https://i.imgur.com/lN2uziy.png" alt=""><br>Issue를 등록할 때 오른쪽 하단의 Epic에서 등록시킬 수 있습니다.</p><h2><span id="issue-연결">Issue 연결</span></h2><p><img src="https://i.imgur.com/XYa3My3.png" alt=""><br>Connect with an issue 기능을 통해서 이슈끼리 연결을 할 수 있습니다. <strong>위처럼 Pull Request를 할 때 아주 유용하게 사용할 수 있습니다.</strong></p><p><img src="https://i.imgur.com/DPrWlUd.png" alt=""><br>Issue 13과 해당 이슈를 작업해서 Pull Request Issue 17 번이 ZenHub 보드에서 연결돼 있는 것을 확인 할 수 있습니다. <strong>이처럼 연관된 작업을 묶어주는 장점이 있습니다.</strong></p><h2><span id="filter-기능">Filter 기능</span></h2><p><img src="https://i.imgur.com/4pZEYsB.png" alt=""></p><p>다양한 Filter 기능을 제공합니다. Label, Assignee, Milestone, Repo 등등이 있습니다. 해당 기능은 직관적이니<br>Repo를 제외하고 따로 설명을 진행하지는 않겠습니다.</p><p>Repo는 여러 Repo를 한꺼번에 보여줄 수 있습니다. 가령 <strong>Back-end, Front-end Repository가 각각 두 개 이고 그 Repo를 한 보드에 표시할 수 있습니다.</strong> 실무 개발에서는 여러 Repo가 있기 때문에 이것을 한 보드에서 볼 수 있다는 것은 정말 좋은 Filter 기능이라고 생각합니다.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2&gt;&lt;span id=&quot;프로젝트-소개&quot;&gt;프로젝트 소개&lt;/span&gt;&lt;/h2&gt;
&lt;p&gt;Github를 이용해서 Project Management 하는 방법 및 전체적인 프로세스에 대해서 정리했습니다. &lt;strong&gt;issue 관리, 일정 관리, 코드리뷰, 
      
    
    </summary>
    
    
      <category term="Github" scheme="https://cheese10yun.github.io/tags/Github/"/>
    
      <category term="Issue" scheme="https://cheese10yun.github.io/tags/Issue/"/>
    
      <category term="Proejct Management" scheme="https://cheese10yun.github.io/tags/Proejct-Management/"/>
    
      <category term="ZenHub" scheme="https://cheese10yun.github.io/tags/ZenHub/"/>
    
  </entry>
  
  <entry>
    <title>Spring-Jpa Best Practices Step-09 - OneToMany 관계 설정 팁(2)</title>
    <link href="https://cheese10yun.github.io/spring-jpa-best-09/"/>
    <id>https://cheese10yun.github.io/spring-jpa-best-09/</id>
    <published>2018-07-16T15:00:00.000Z</published>
    <updated>2018-07-16T17:42:59.867Z</updated>
    
    <content type="html"><![CDATA[<p>해당 코드는 <a href="https://github.com/cheese10yun/spring-jpa-best-practices" rel="external nofollow noopener noreferrer" target="_blank">Github</a>를 확인해주세요.</p><p>이전에 OneToMany 관계 설정 포스팅이 관계설정의 초점보다는 풍부한 객체 관점 중심으로 다루었습니다. 그러다 보니 OneToMany에 대한 관계에 대한 설명 부분이 부족해서 추가 포스팅을 하게 되었습니다.</p><h2><span id="요구사항">요구사항</span></h2><ul><li>배송이 이 있고 배송의 상태를 갖는 배송 로그가 있습니다.</li><li>배송과 배송 상태는 1:N 관계를 갖는다.</li><li>배송은 배송 상태를 1개 이상 반드시 갖는다.</li></ul><h2><span id="entity">Entity</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Entity</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Delivery</span> </span>&#123;</div><div class="line">    <span class="meta">@Id</span> <span class="meta">@GeneratedValue</span>(strategy = GenerationType.AUTO)</div><div class="line">    <span class="keyword">private</span> <span class="keyword">long</span> id;</div><div class="line"></div><div class="line">    <span class="meta">@Embedded</span></div><div class="line">    <span class="keyword">private</span> Address address;</div><div class="line"></div><div class="line">    <span class="meta">@OneToMany</span>(mappedBy = <span class="string">"delivery"</span>, cascade = CascadeType.PERSIST, orphanRemoval = <span class="keyword">true</span>, fetch = FetchType.EAGER)</div><div class="line">    <span class="keyword">private</span> List&lt;DeliveryLog&gt; logs = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Entity</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeliveryLog</span> </span>&#123;</div><div class="line">    <span class="meta">@Id</span> <span class="meta">@GeneratedValue</span>(strategy = GenerationType.AUTO)</div><div class="line">    <span class="keyword">private</span> <span class="keyword">long</span> id;</div><div class="line"></div><div class="line">    <span class="meta">@Enumerated</span>(EnumType.STRING)</div><div class="line">    <span class="meta">@Column</span>(name = <span class="string">"status"</span>, nullable = <span class="keyword">false</span>, updatable = <span class="keyword">false</span>)</div><div class="line">    <span class="keyword">private</span> DeliveryStatus status;</div><div class="line"></div><div class="line">    <span class="meta">@ManyToOne</span></div><div class="line">    <span class="meta">@JoinColumn</span>(name = <span class="string">"delivery_id"</span>, nullable = <span class="keyword">false</span>, updatable = <span class="keyword">false</span>)</div><div class="line">    <span class="keyword">private</span> Delivery delivery;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2><span id="delivery-저장">Delivery 저장</span></h2><p>일대다 관계에서는 다 쪽이 외래 키를 관리하게 됩니다. JPA 상에서는 왜래 키가 갖는 쪽이 연관 관계의 주인이 되고 연관 관계의 주인만이 데이터베이스 연관 관계와 매핑되고 왜래 키를 관리(등록, 수정, 삭제)할 수 있으므로 DeliveryLog에서 Delivery를 관리하게 됩니다. <strong>하지만 DeliveryLog는 Delivery 상태를 저장하는 로그 성격 이기 때문에 핵심 비즈니스 로직을 Delivery에서 작성하는 것이 바람직합니다.</strong></p><p>이럴 때 편의 메소드와 Cascade 타입 PERSIST 이용하면 보다 이러한 문제를 해결 할 수 있습니다.</p><h3><span id="편의-메소드">편의 메소드</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Delivery</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addLog</span><span class="params">(DeliveryStatus status)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.logs.add(DeliveryLog.builder()</div><div class="line">                .status(status)</div><div class="line">                .delivery(<span class="keyword">this</span>) <span class="comment">// this를 통해서 Delivery를 넘겨준다.</span></div><div class="line">                .build());</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">DeliveryLog</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DeliveryLog</span><span class="params">(<span class="keyword">final</span> DeliveryStatus status, <span class="keyword">final</span> Delivery delivery)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.delivery = delivery;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">DeliveryService</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> Delivery <span class="title">create</span><span class="params">(DeliveryDto.CreationReq dto)</span> </span>&#123;</div><div class="line">        <span class="keyword">final</span> Delivery delivery = dto.toEntity();</div><div class="line">        delivery.addLog(DeliveryStatus.PENDING);</div><div class="line">        <span class="keyword">return</span> deliveryRepository.save(delivery);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>Delivery가 시작되면 DeliveryLog는 반드시 PENDDING이어야 한다고 가정했을 경우 편의 메소드를 이용해서 두 객체에 모두 필요한 값을 바인딩시켜줍니다.</p><h3><span id="casecade-persist-설정">CaseCade PERSIST 설정</span></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">// cascade 없는 경우</div><div class="line">Hibernate: <span class="keyword">insert</span> <span class="keyword">into</span> delivery (<span class="keyword">id</span>, address1, address2, zip, created_at, update_at) <span class="keyword">values</span> (<span class="literal">null</span>, ?, ?, ?, ?, ?)</div><div class="line"></div><div class="line">// <span class="keyword">cascade</span> PERSIST 설정 했을 경우</div><div class="line">Hibernate: <span class="keyword">insert</span> <span class="keyword">into</span> delivery (<span class="keyword">id</span>, address1, address2, zip, created_at, update_at) <span class="keyword">values</span> (<span class="literal">null</span>, ?, ?, ?, ?, ?)</div><div class="line">Hibernate: <span class="keyword">insert</span> <span class="keyword">into</span> delivery_log (<span class="keyword">id</span>, created_at, update_at, delivery_id, <span class="keyword">status</span>) <span class="keyword">values</span> (<span class="literal">null</span>, ?, ?, ?, ?)</div></pre></td></tr></table></figure><p>CaseCade PERSIST을 통해서 Delivery 엔티티에서 DeliveryLog를 생성할수 있게 설정합니다. CaseCade PERSIST가 없을 때 실제 객체에는 저장되지만, 영속성 있는 데이터베이스에 저장에 필요한 insert query가 동작하지 않습니다.</p><p><strong>JPA를 잘활용하면 도메인의 의도가 분명하게 들어나도록 개발할 수 있다는 것을 강조드리고 싶습니다.</strong></p><h2><span id="고아-객체-orphanremoval">고아 객체 (orphanRemoval)</span></h2><p>JPA는 부모 엔티티와 연관 관계가 끊어진 자식 엔티티를 자동으로 삭제하는 기능을 제공하는데 이것을 고아 객체 제거라 합니다. 이 기능을 사용해서 부모 엔티티의 컬렉션에서 자식 엔티티의 참조만 제거하면 자식 엔티티가 자동으로 삭제 돼서 개발의 편리함이 있습니다.</p><h3><span id="deliverylog-삭제">DeliveryLog 삭제</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> Delivery <span class="title">removeLogs</span><span class="params">(<span class="keyword">long</span> id)</span> </span>&#123;</div><div class="line">    <span class="keyword">final</span> Delivery delivery = findById(id);</div><div class="line">    delivery.getLogs().clear(); <span class="comment">// DeloveryLog 전체 삭제</span></div><div class="line">    <span class="keyword">return</span> delivery; <span class="comment">// 실제 DeloveryLog 삭제 여부를 확인하기 위해 리턴</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// <span class="keyword">delete</span> <span class="keyword">SQL</span></div><div class="line">Hibernate: <span class="keyword">delete</span> <span class="keyword">from</span> delivery_log <span class="keyword">where</span> <span class="keyword">id</span>=?</div></pre></td></tr></table></figure><p>Delivery 객체를 통해서 DeliveryLog를 위처럼 직관적으로 삭제 할 수 있습니다. 이 처럼 직관적으로 그 의도가 드러나는 장점이 있다고 생각합니다.</p><h3><span id="delivery-삭제">Delivery 삭제</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(<span class="keyword">long</span> id)</span></span>&#123;</div><div class="line">    deliveryRepository.delete(id);</div><div class="line">&#125;</div></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">// <span class="keyword">delete</span> <span class="keyword">SQL</span></div><div class="line">Hibernate: <span class="keyword">delete</span> <span class="keyword">from</span> delivery_log <span class="keyword">where</span> <span class="keyword">id</span>=?</div><div class="line">Hibernate: <span class="keyword">delete</span> <span class="keyword">from</span> delivery <span class="keyword">where</span> <span class="keyword">id</span>=?</div></pre></td></tr></table></figure><p>delivery, deliverylog 참조 관계를 맺고 있어 Delivery만 삭제할 수 없습니다. delete SQL을 보시다시피 delivery_log 부터 제거 이후 delivery를 제거하는 것을 알 수 있습니다. 이처럼 orphanRemoval 속성으로 더욱 쉽게 삭제 할 수 있습니다.</p><h3><span id="orphanremoval-설정이-없는-경우">orphanRemoval 설정이 없는 경우</span></h3><p>DeliveryLog 삭제 같은 경우에는 실제 객체에서는 clear() 메서드로 DeliveryLog가 삭제된 것처럼 보이지만 영속성 있는 데이터를 삭제하는 것은 아니기에 해당 Delivery를 조회하면 DeliveryLog가 그대로 조회됩니다. 실수하기 좋은 부분이기에 반드시 삭제하고 조회까지 해서 데이터베이스까지 확인하시는 것을 권장해 드립니다.</p><p><img src="https://i.imgur.com/bPhMX9e.png" alt=""></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// erorr log</div><div class="line">o.h.engine.jdbc.spi.SqlExceptionHelper   : Referential integrity constraint violation: &quot;FKFS49KM0EA809MTH3OQ4S6810H: PUBLIC.DELIVERY_LOG FOREIGN KEY(DELIVERY_ID) REFERENCES PUBLIC.DELIVERY(ID) (1)&quot;; SQL statement:</div></pre></td></tr></table></figure><p>위에서 언급했듯이 delivery를 삭제하려면 참조 하는 deliverylog 먼저 삭제를 진행 해야 합니다. orphanRemoval 설정이 없는 경우 그 작업을 선행하지 않으니 위 같은 에러가 발생하게 됩니다.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;해당 코드는 &lt;a href=&quot;https://github.com/cheese10yun/spring-jpa-best-practices&quot; rel=&quot;external nofollow noopener noreferrer&quot; target=&quot;_blank&quot;&gt;Git
      
    
    </summary>
    
    
      <category term="Spring" scheme="https://cheese10yun.github.io/tags/Spring/"/>
    
      <category term="JPA" scheme="https://cheese10yun.github.io/tags/JPA/"/>
    
      <category term="Best Practices" scheme="https://cheese10yun.github.io/tags/Best-Practices/"/>
    
  </entry>
  
  <entry>
    <title>Github로 프로젝트 관리하기 Part2</title>
    <link href="https://cheese10yun.github.io/github-proejct-part2/"/>
    <id>https://cheese10yun.github.io/github-proejct-part2/</id>
    <published>2018-07-13T15:00:00.000Z</published>
    <updated>2018-07-17T13:48:26.576Z</updated>
    
    <content type="html"><![CDATA[<h1><span id="프로젝트-소개">프로젝트 소개</span></h1><p>Github를 이용해서 Project Management 하는 방법 및 전체적인 프로세스에 대해서 정리했습니다. <strong>issue 관리, 일정 관리, 코드리뷰, 버그 리포트 등 다양한 일들을 Github 하나에서 다 관리할 수 있고 어느 하나 부족하다고 생각하지 않습니다.</strong> 이미 Remote Repository로 Github를 사용 중 이리 사면 적극 추천해 드립니다.</p><h1><span id="ci-amp-test-coverage">CI &amp; Test Coverage</span></h1><p><img src="https://i.imgur.com/G5jo0Ty.png" alt=""></p><p><a href="https://github.com/marketplace/category/continuous-integration" rel="external nofollow noopener noreferrer" target="_blank">GitHub Marketplace</a> Public Repository를 이용하면 대부분 무료로 이용 가능합니다. <strong>본 포스팅에서는  CI는 Travis CI, Test Coverage는 Coveralls를 이용해서 진행하겠습니다.</strong></p><p>전체적인 플로우를 설명하는 것이 목적 이리서 특정 툴에 대한 직접적인 사용법을 다루지는 않겠습니다. 언어의 특성 및 개인에 기호에 맞는 제품을 사용하시면 됩니다.</p><h2><span id="전체-플로우">전체 플로우</span></h2><ol><li>Pull Request 요청 -&gt; Code Review 진행</li><li>Code Review 완료 -&gt; 특정 Branch에 반영</li><li>특정 Branch 수정시 자동 CI Build 작업 진행 -&gt; 테스트 코드 실행</li><li>테스트 커버지리 표시</li></ol><h2><span id="pull-request-amp-code-review">Pull Request &amp; Code Review</span></h2><p><img src="https://i.imgur.com/q6HmT7o.png" alt=""></p><p>별다른 설정을 하지 않았다면 Pull Request를 요청할 경우 Travis에서 자동으로 해당 요청한 코드 기반으로 Build 작업이 진행됩니다. Build가 실패했을 경우는 Pull Request 요청자는 코드를 수정해서 최소한 Build가 된 코드 기반으로 Code Review를 진행하게 해야 됩니다(Build도 안 되는 코드를 리뷰할 이유는 없을 거 같습니다.)</p><p>요청받은 Pull Request에 대해서 Code Review 작업을 진행하게 됩니다. Code Review가 완료되면 Merge pull request를 통해서 해당 작업(issue)을 반영합니다.</p><h2><span id="테스트-커버지리-표시">테스트 커버지리 표시</span></h2><p><img src="https://i.imgur.com/U1ROYeE.png" alt=""></p><p>위에서 Merge pull request를 통해서 해당 작업(issue)을 반영했다면 Travis가 Build 할 때 작성된 Test Code 기반으로 Coverage 정보를 위처럼 자동으로 코멘드를 추가해줍니다.</p><p>누군가가 테스트 코드를 작성하지 않았다면 <code>Change from base</code> 항목에서 - 표시가 됩니다. <strong>이렇게 해당 작업마다 커버리지를 표시하는 것이 전체 커버리지를 높이고 그 값을 유지하는 좋은 방법이라고 생각합니다.</strong></p><h1><span id="wiki">Wiki</span></h1><p>GitHub에서는 기본적인 WIKI 기능을 제공해줍니다.</p><h2><span id="wiki-등록">Wiki 등록</span></h2><p><img src="https://github.com/cheese10yun/github/blob/master/images/wiki.gif?raw=true" alt=""></p><h2><span id="github-작성">GitHub 작성</span></h2><p><img src="https://i.imgur.com/t3LuQsm.png" alt=""><br>GitHub에서 위키를 작성할 수 있습니다.</p><h2><span id="local-작성">Local 작성</span></h2><p><img src="https://i.imgur.com/Ff6Heeb.png" alt=""><br><strong>위키를 로컬환경에서 작성해서 Push 할 수 있습니다. 이렇게 사용하시는 것을 추천 드립니다.</strong></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1&gt;&lt;span id=&quot;프로젝트-소개&quot;&gt;프로젝트 소개&lt;/span&gt;&lt;/h1&gt;
&lt;p&gt;Github를 이용해서 Project Management 하는 방법 및 전체적인 프로세스에 대해서 정리했습니다. &lt;strong&gt;issue 관리, 일정 관리, 코드리뷰, 
      
    
    </summary>
    
    
      <category term="Github" scheme="https://cheese10yun.github.io/tags/Github/"/>
    
      <category term="Issue" scheme="https://cheese10yun.github.io/tags/Issue/"/>
    
      <category term="Proejct Management" scheme="https://cheese10yun.github.io/tags/Proejct-Management/"/>
    
  </entry>
  
  <entry>
    <title>Jackson 어노테이션 총 정리</title>
    <link href="https://cheese10yun.github.io/jackson-annotation-final/"/>
    <id>https://cheese10yun.github.io/jackson-annotation-final/</id>
    <published>2018-07-08T10:00:00.000Z</published>
    <updated>2018-07-08T10:03:55.914Z</updated>
    
    <content type="html"><![CDATA[<iframe src="//www.slideshare.net/slideshow/embed_code/key/3bcVswknGqlE8u" width="595" height="485" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe> <div style="margin-bottom:5px"> <strong> <a href="//www.slideshare.net/ssuser565d51/jackson-104816215" title="Jackson 사용법" target="_blank">Jackson 사용법</a> </strong> from <strong><a href="https://www.slideshare.net/ssuser565d51" target="_blank" rel="external nofollow noopener noreferrer">남윤 김</a></strong> </div>]]></content>
    
    <summary type="html">
    
      
      
        &lt;iframe src=&quot;//www.slideshare.net/slideshow/embed_code/key/3bcVswknGqlE8u&quot; width=&quot;595&quot; height=&quot;485&quot; frameborder=&quot;0&quot; marginwidth=&quot;0&quot; marginhe
      
    
    </summary>
    
    
      <category term="Jackson" scheme="https://cheese10yun.github.io/tags/Jackson/"/>
    
      <category term="Slideshare" scheme="https://cheese10yun.github.io/tags/Slideshare/"/>
    
  </entry>
  
  <entry>
    <title>Github로 프로젝트 관리하기 Part1</title>
    <link href="https://cheese10yun.github.io/github-proejct/"/>
    <id>https://cheese10yun.github.io/github-proejct/</id>
    <published>2018-07-08T08:13:46.000Z</published>
    <updated>2018-07-14T10:32:04.300Z</updated>
    
    <content type="html"><![CDATA[<h1><span id="프로젝트-소개">프로젝트 소개</span></h1><p>Github를 이용해서 Project Management 하는 방법 및 전체적인 프로세스에 대해서 정리했습니다. <strong>issue 관리, 일정 관리, 코드리뷰, 버그 리포트 등 다양한 일들을 Github 하나에서 다 관리할 수 있고 어느 하나 부족하다고 생각하지 않습니다.</strong> 이미 Remote Repository로 Github를 사용 중 이리 사면 적극 추천해 드립니다.</p><p>프로젝트는 지속해서 추가될 예정이라 상단의 전체 사용법은 <a href="https://github.com/cheese10yun/github" rel="external nofollow noopener noreferrer" target="_blank">Github</a>에서 확인하실 수 있습니다.</p><h1><span id="목차">목차</span></h1><!-- TOC --><ul><li><a href="#%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EC%86%8C%EA%B0%9C">프로젝트 소개</a></li><li><a href="#%EB%AA%A9%EC%B0%A8">목차</a></li><li><a href="#%EC%A0%84%EC%B2%B4-%ED%94%8C%EB%A1%9C%EC%9A%B0">전체 플로우</a><ul><li><a href="#issue-%EB%B0%9C%ED%96%89">Issue 발행</a><ul><li><a href="#issue%EB%9E%80">Issue란?</a></li><li><a href="#issue-template">Issue Template</a><ul><li><a href="#issue-template-%EB%93%B1%EB%A1%9D">Issue Template 등록</a></li><li><a href="#issue-template-%EC%82%AC%EC%9A%A9%EB%B2%95">Issue Template 사용법</a></li><li><a href="#issue-template-%ED%8C%8C%EC%9D%BC">Issue Template 파일</a></li></ul></li></ul></li><li><a href="#issue-%EC%9E%91%EC%97%85">Issue 작업</a><ul><li><a href="#%EB%93%B1%EB%A1%9D%EB%90%9C-issue-%EC%82%B4%ED%8E%B4-%EB%B3%B4%EA%B8%B0">등록된 issue 살펴 보기</a></li><li><a href="#issue-%EC%97%B0%EB%8F%99">Issue 연동</a></li><li><a href="#issue-%EA%B8%B0%EB%B0%98-bracnh-%EC%83%9D%EC%84%B1">Issue 기반 Bracnh 생성</a></li></ul></li><li><a href="#pull-requestcode-review">Pull Request[Code Review]</a><ul><li><a href="#jetbrains-pull-request">Jetbrains Pull Request</a></li><li><a href="#github-pull-request">GitHub Pull Request</a></li><li><a href="#pull-request-%EC%9E%91%EC%84%B1%EB%B2%95">Pull Request 작성법</a></li><li><a href="#code-review">Code Review</a></li></ul></li></ul></li><li><a href="#%EC%84%B8%EB%B6%80-%EC%82%AC%EC%9A%A9%EB%B2%95">세부 사용법</a></li><li><a href="#zenhub-%EC%82%AC%EC%9A%A9%EB%B2%95">ZenHub 사용법</a></li><li><a href="#code-coverage">Code Coverage</a></li></ul><!-- /TOC --><h1><span id="전체-플로우">전체 플로우</span></h1><ol><li>Isuee 발급</li><li>Issue 작업</li><li>Pull Request Coide Review 진행</li><li>Issue 반영</li></ol><h2><span id="issue-발행">Issue 발행</span></h2><h3><span id="issue란">Issue란?</span></h3><p>모든것이 이슈라고 볼 수 있습니다. 새로운 추가될 가능, 개선 해야할 가능, 버그 등등 모든것이 이슈라고 볼 수 있습니다. 모든 활동 내역에 대해서 이슈를 등록하고 그 이슈기반으로 작업을 진행하게 됩니다.</p><p>이슈를 등록할 때 자주 사용하는 템플릿을 등록해서 사용하는 방법이 효율적입니다. 이슈 템플릿을 등록하는 방법을 소개해드리겠습니다.</p><h3><span id="issue-template">Issue Template</span></h3><h4><span id="issue-template-등록">Issue Template 등록</span></h4><p><img src="https://github.com/cheese10yun/github/blob/master/images/issue-template-rg.gif?raw=true" alt=""></p><p>환경에 앎맞는 Issue Template 생성을 합니다.</p><h4><span id="issue-template-사용법">Issue Template 사용법</span></h4><p><img src="https://github.com/cheese10yun/github/blob/master/images/add-new-issue.gif?raw=true" alt="new_issue"></p><p>위에서 등록한 Issue Template 기반으로 이슈를 생성할 수 있습니다.</p><h4><span id="issue-template-파일">Issue Template 파일</span></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">.</div><div class="line">├── .github</div><div class="line">│   └── ISSUE_TEMPLATE</div><div class="line">│       ├── bug_report.md</div><div class="line">│       └── feature_request.md</div><div class="line">├── README.md</div><div class="line">├── github.iml</div><div class="line">├── images</div><div class="line">├── mvnw</div><div class="line">├── mvnw.cmd</div><div class="line">├── pom.xml</div><div class="line">└── src</div></pre></td></tr></table></figure><p>위에서 등록된 Issue Template은 .github/ISSUE_TEMPLATE 디렉터리에 생성된 것을 확인할 수 있습니다.<br><strong>각자의 맞는 한경에 따라서 Issue Template를 작성하시면 됩니다.</strong> 저 같은 경우에는 Back-end를 주로 담당하기 때문에 bug tempalte 에서 서버로그, response body 값을 등록했습니다.</p><h2><span id="issue-작업">Issue 작업</span></h2><h3><span id="등록된-issue-살펴-보기">등록된 issue 살펴 보기</span></h3><p><img src="https://i.imgur.com/2ciNoCd.png" alt="등록된-이슈"></p><ul><li>Assignees : 해당 작업의 담당자</li><li>Labels: 해당 작업의 성격</li><li>Milestone: 해당 작업이 속한 파트</li></ul><p><img src="https://i.imgur.com/DkniJHn.png" alt=""></p><p>다른 것들은 이해하기 쉬울 텐데 Milestone은 조금 생소할 수 있습니다. Milestone에 간단하게 설명해 드리면 이번 출시 버전이 1.0.0 일 경우 해당 버전이든 이슈(작업) 기능 강화, 새 기능추가, 버그 기타 등등 모든 이슈를 Version 1.0.0 Milestone이라는 항목에 추가하면 위 그림처럼 Version 1.0.0에 대한 전체적인 상황을 한눈에 볼 수가 있는 장점이 있습니다.</p><h3><span id="issue-연동">Issue 연동</span></h3><p><img src="https://i.imgur.com/FtO0Xme.png" alt="intellij-task"></p><p>만약 Jetbrains의 IDE를 사용하고 계신다면 Task 연동을 통해서 Github와 연동하시는 것을 적극 권장해 드립니다.</p><h3><span id="issue-기반-bracnh-생성">Issue 기반 Bracnh 생성</span></h3><p><img src="https://i.imgur.com/R8aFoCL.png" alt="issue-base-branch"><br>위에서 언급한 Jetbrains의 Task 연동을 하지 않아도 크게 상관없습니다. Task의 갖는 가장 큰 기능은 Github 이슈 기반으로 Branch를 생성을 쉽게 도와주는 것으로 생각합니다. <strong>즉 Github에서 생성된 Issue 기반으로 Branch를 생성하는 것이 핵심입니다.</strong></p><p>Github Issue는 각자의 유니크한 값인 Issue Number를 갖습니다. 또 그 Iusse Number 기반으로 Branch를 이름을 갖게 하여 해당 Branch의 명확한 작업의 의도를 갖게 할 수 있습니다.</p><p>Branch 네이밍을 통해서 해당 작업의 의도를 갖게 하는 것은 한계가 있습니다. 또 동료 개발자들이 정확히 무슨 작업을 하는지도 Branch 네이밍을 통해서 유추해내기도 어렵고, 해당 작업이 반영(머지)될 때 도 마찬가지입니다. 이러한 문제들을 Issue Number 기반으로 Branch를 생성(Issue Number Branch 네이밍에 추가)하면 아주 명확해집니다.</p><h2><span id="pull-requestcode-review">Pull Request[Code Review]</span></h2><p><a href="https://github.com/cheese10yun/github/issues/1" rel="external nofollow noopener noreferrer" target="_blank">issue-1</a>에 대한 풀리퀘스트를 통해서 코드리뷰를 진행해 보겠습니다.</p><h3><span id="jetbrains-pull-request">Jetbrains Pull Request</span></h3><p><img src="https://i.imgur.com/vkNR06g.png" alt="intellij-pull-request"><br>만약 Jetbrains IDE를 사용하신다면 위 방법 처럼 Pull Request를 하는 방법을 권장드립니다.</p><h3><span id="github-pull-request">GitHub Pull Request</span></h3><p><img src="https://i.imgur.com/6bBTJUV.png" alt="github-pull-request"></p><p>Github Code 텝에서 <code>New Pull Request</code> 버튼을 클릭해서 Pull Request를 진행 합니다.</p><h3><span id="pull-request-작성법">Pull Request 작성법</span></h3><p><img src="https://i.imgur.com/3TnHt0c.png" alt=""></p><ul><li>왼쪽 위에 Reviewers 톱니바퀴 버튼을 클릭해서 리뷰어를 지정합니다.</li><li>resolved: #1(해당 Issue Number) 풀리퀘스트 요청하는 이유 즉 무슨 이슈에 대한 작업인지 명시합니다.</li></ul><p><code>resolved</code> 키워드를 입력하면 해당 풀리퀘스트가 master Branch에 반영되면 자동으로 close 됩니다. 자동으로 close 되는 것이 싫으시다면 issue: #[해당 Issue Number]를 작성해주세요.</p><p>이렇게 Pull Request가 생성되면 새로운 Issue Number가 부여됩니다. <strong>즉 Pull Request도 Issue입니다.</strong></p><p><img src="https://i.imgur.com/skNmpeQ.png" alt="issue-pull-request-연결"></p><p><strong>반드시 해당 풀리퀘스트가 무슨 이슈에 따른 요청인지 명시하시는 것을 권장합니다.</strong> 그렇게 되면 위 그림처럼 해당 이슈에 #2[방금 요청한 풀리퀘스트]가 연결되어 해당 이슈가 무슨 코드로 인해서 진행됐는지 추적하기 좋습니다.</p><h3><span id="code-review">Code Review</span></h3><p>리뷰어가 요청받은 Pull Request로 가서 <code>Add your review</code> 버튼을 클릭합니다.</p><p><img src="https://i.imgur.com/k11vL5w.png" alt="리뷰진행"><br>소스코드에 대한 질문 등 다양한 comment를 남기는 방식으로 pull reqeust가 진행합니다.</p><ul><li>Approve: 코드에 대한 의문점이 없다면 승인 .</li><li>Comment: 간단한 피드백 제출</li><li>Request changes: 해당 코드에 문제가 있다고 판단되며 코드를 반드시 수정 요구</li></ul><p>위 항목은 Comment로 Submit review를 진행했습니다.</p><p><img src="https://i.imgur.com/EHnVEjU.png" alt="comment-표시"><br>위에서 작성한 comment가 해결됬었다면 <code>Merge pull request</code> 버튼을 눌러서 해당 pull request를 반영합니다. 반영이 완료되고 해당 branch가 더는 필요 없다고 판단되시면 <code>Delete branch</code> 버튼을 통해서 Remote에 있는 Branch를 삭제할 수 있습니다.</p><p><strong>위에서 작성한 resolved: #1 키워드 덕분에 소스코드가 해당 Branch에 적용됐으니 자동으로 #1에 대한 이슈는 close 처리됩니다.</strong></p><h1><span id="세부-사용법">세부 사용법</span></h1><ul><li>추가 예정</li></ul><h1><span id="zenhub-사용법">ZenHub 사용법</span></h1><ul><li>추가 예정</li></ul><h1><span id="code-coverage">Code Coverage</span></h1><ul><li>추가 예정</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1&gt;&lt;span id=&quot;프로젝트-소개&quot;&gt;프로젝트 소개&lt;/span&gt;&lt;/h1&gt;
&lt;p&gt;Github를 이용해서 Project Management 하는 방법 및 전체적인 프로세스에 대해서 정리했습니다. &lt;strong&gt;issue 관리, 일정 관리, 코드리뷰, 
      
    
    </summary>
    
    
      <category term="Github" scheme="https://cheese10yun.github.io/tags/Github/"/>
    
      <category term="Issue" scheme="https://cheese10yun.github.io/tags/Issue/"/>
    
      <category term="Proejct Management" scheme="https://cheese10yun.github.io/tags/Proejct-Management/"/>
    
  </entry>
  
  <entry>
    <title>Spring OOP 프로그래밍 예제(5) - 외부 API(PagerDuty) 호출</title>
    <link href="https://cheese10yun.github.io/spring-oop-05/"/>
    <id>https://cheese10yun.github.io/spring-oop-05/</id>
    <published>2018-07-05T15:00:00.000Z</published>
    <updated>2018-07-07T15:18:52.937Z</updated>
    
    <content type="html"><![CDATA[<p>예제 코드는 <a href="https://github.com/cheese10yun/blog-sample/tree/master/pagerduty" rel="external nofollow noopener noreferrer" target="_blank">Github : blog-sample</a>에 공개 되어 있습니다.</p><h1><span id="외부-apipagerduty-호출">외부 API(PagerDuty) 호출</span></h1><p>최근 외부 API를 통신하는 일들이 많이 있었고 최근 PagerDuty API 작업을 하면서 외부 API를 사용할 때 많은 시행착오와 고민을 나름 정리해 보았습니다.</p><h2><span id="pagerduty-request">PagerDuty Request</span></h2><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"routing_key"</span>: <span class="string">"routing_key..."</span>,</div><div class="line">    <span class="attr">"event_action"</span>: <span class="string">"only trigger, acknowledge, resolve"</span>,</div><div class="line">    <span class="attr">"images"</span>: [],</div><div class="line">    <span class="attr">"links"</span>: [],</div><div class="line">    <span class="attr">"payload"</span>: &#123;</div><div class="line">        <span class="attr">"summary"</span>: <span class="string">"summary...(string)"</span>,</div><div class="line">        <span class="attr">"source"</span>: <span class="string">"System..."</span>,</div><div class="line">        <span class="attr">"severity"</span>: <span class="string">"only critical, error, warning, info"</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2><span id="pagerduty-response">PagerDuty Response</span></h2><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"status"</span>: <span class="string">"success"</span>,</div><div class="line">  <span class="attr">"message"</span>: <span class="string">"Event processed"</span>,</div><div class="line">  <span class="attr">"dedup_key"</span>: <span class="string">"samplekeyhere"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><p><a href="https://v2.developer.pagerduty.com/docs/send-an-event-events-api-v2" rel="external nofollow noopener noreferrer" target="_blank">PagerDuty Document</a>에 나와 있는 Request, Response를 JSON으로 정리했습니다. Request 값은 필수 값 위주로 정리했습니다.</p><h2><span id="request-response-class">Request, Response Class</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Getter</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Request</span> </span>&#123;</div><div class="line">    <span class="meta">@JsonProperty</span>(<span class="string">"event_action"</span>)</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> EventAction eventAction;</div><div class="line">    <span class="meta">@JsonProperty</span>(<span class="string">"routing_key"</span>)</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String routingKey = <span class="string">"routingKey..."</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Payload payload;</div><div class="line"></div><div class="line">    <span class="meta">@Builder</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Request</span><span class="params">(<span class="keyword">final</span> EventAction eventAction, <span class="keyword">final</span> Payload payload)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.eventAction = eventAction;</div><div class="line">        <span class="keyword">this</span>.payload = payload;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Getter</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Payload</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String summary;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String timestamp = ZonedDateTime.now().toOffsetDateTime().format(DateTimeFormatter.ISO_OFFSET_DATE_TIME);</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Severity severity;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Group group;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Source source;</div><div class="line">    <span class="meta">@JsonProperty</span>(<span class="string">"custom_details"</span>)</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object customDetails;</div><div class="line"></div><div class="line">    <span class="meta">@Builder</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Payload</span><span class="params">(<span class="keyword">final</span> String summary, <span class="keyword">final</span> Severity severity, <span class="keyword">final</span> Group group, <span class="keyword">final</span> Source source, <span class="keyword">final</span> Object customDetails)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.summary = summary;</div><div class="line">        <span class="keyword">this</span>.severity = severity;</div><div class="line">        <span class="keyword">this</span>.group = group;</div><div class="line">        <span class="keyword">this</span>.source = source;</div><div class="line">        <span class="keyword">this</span>.customDetails = customDetails;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Getter</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Response</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> String status;</div><div class="line">    <span class="keyword">private</span> String message;</div><div class="line">    <span class="meta">@JsonProperty</span>(<span class="string">"dedup_key"</span>)</div><div class="line">    <span class="keyword">private</span> String dedupKey;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure><h3><span id="request-response에-대한-dto-클래스-생성">Request, Response에 대한 DTO 클래스 생성</span></h3><p>위의 JSON을 클래스로 바인딩시킬 DTO 클래스를 생성해서 API에 대한 Request, Response를 관리하는 것이 바람직합니다. 간혹 Map, JSON(gsoon, jackson) 등을 이용해서 유연하게 두는 예도 있지만 <strong>저는 개인적으로 권장하지 않습니다.</strong> 가장 큰 이유는 해당 값에 무슨 데이터가 있는지 확인하기 어렵습니다. 코드 가독성이 심각하게 떨어지며 정확히 어떤 자료형인지 확인하기도 어렵습니다. 또 @JsonProperty를 통해서 해당 실제 JSON 키값과 객체의 멤버 필드 값을 다르게 설정 할 수 있습니다.</p><h3><span id="setter를-사용하지-않기">Setter를 사용하지 않기</span></h3><p>이전 포스팅에서도 <a href="https://github.com/cheese10yun/spring-jpa-best-practices/blob/master/doc/step-06.md" rel="external nofollow noopener noreferrer" target="_blank">Setter 사용하지 않기</a>를 언급한 적이 있습니다. Response DTO 클래스 같은 경우는 더욱 Setter를 제공할 필요가 없지만, 관습적으로 Setter 메서드를 추가하는 경우가 많습니다. <strong>해당 객체를 어디서든지 변경이 가능한 객체가 되기 때문에 명확한 이유 없이 관습적인 Setter는 반드시 지양 해야 합니다.</strong></p><p>반면 Request 객체는 필요한 값을 바인딩시켜 보내줘야 합니다. 이러한 경우는 Builder 패턴을 이용해서 객체를 생성하면 많은 장점이 있습니다. 제가 느끼는 대표적인 장점들 아래와 같습니다.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">PagerDutyDto.Request.builder()</div><div class="line">    .eventAction(PagerDutyDto.EventAction.acknowledge)</div><div class="line">    .payload(Payload ...)</div><div class="line">    .build();</div></pre></td></tr></table></figure><ol><li>인자의 순서에 영향 받지 않습니다. 생성자로 생성했을 경우 인자의 순서가 중요하며, 특히 같은 자료형에 대한 인자는 실수할 수 있는 여지가 높습니다.</li><li><strong>Setter 메서드가 없어 변경 불가능 객체를 만들 수 있습니다.</strong></li></ol><p>그렇다면 객체의 수정이 필요 하면 어떻게 어떻게 해야 할까요?</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> String email;</div><div class="line">    <span class="keyword">private</span> String name;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">changeEmail</span><span class="params">(String email)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.email = email;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>객체의 멤버필드를 수정 할 수 있는 수정 메소드를 재공 해주면 됩니다. 단순하게 setter라는 네이밍으로 공개하는 것보다 해당 메소드의 기능을 잘 표현하는 네이밍을 갖는 것이 적합합니다. 더 구체적인 내용은 이전 포스팅 <a href="https://github.com/cheese10yun/spring-jpa-best-practices/blob/master/doc/step-06.md#updatemyaccount-%EB%A9%94%EC%84%9C%EB%93%9C%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8" rel="external nofollow noopener noreferrer" target="_blank">Settet 사용하지 않기</a>에 정리 되어 있습니다.</p><h2><span id="enum을-활용한-안전성-보장">Enum을 활용한 안전성 보장</span></h2><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"event_action"</span>: <span class="string">"only trigger, acknowledge, resolve"</span>,</div><div class="line">    <span class="attr">"payload"</span>: &#123;</div><div class="line">        <span class="attr">"severity"</span>: <span class="string">"only critical, error, warning, info"</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>PagerDuty API event_action, payload.severity 의 value는 위에서 정의한 값 이외의 값이 넘어오면 status 400이 리턴 됩니다. 이러한 값들에 대해서는 아래 코드처럼 enum 클래스로 안전성을 확보하는 것이 바람직합니다.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">enum</span> EventAction &#123;</div><div class="line">    trigger, acknowledge, resolve</div><div class="line">&#125;</div><div class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Severity &#123;</div><div class="line">    info, error, warn</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>String으로 관리할 경우 해당 값 이외의 입력에 대한 예외코드를 작성하면 런타임시에 발생하게 됩니다. enum 클래스로 관리했을 경우 개발자는 해당 enum 값이 외에는 값을 넣을 수도 없게끔 강제하는 것이 실수를 줄이는 방법입니다. String은 변경 및 유지 보수에 취약합니다. 이처럼 API에서 강제된 항목들은 enum 클래스로 관리하는 것이 바람직합니다.</p><h2><span id="각각의-메소드에-책임-부여">각각의 메소드에 책임 부여</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendErrorMessage</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="comment">// 적절한 Error Message를 가공하는 책임</span></div><div class="line">    <span class="comment">// 해당 메소드의 변경시 이유는 Error Message의 변경시에만 변경 이유를 갖는다</span></div><div class="line">    <span class="keyword">final</span> PagerDutyDto.Request request = buildErrorMessage();</div><div class="line">    send(request);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendInfoMessage</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="comment">// 적절한 Info Message를 가공하는 책임</span></div><div class="line">    <span class="comment">// 해당 메소드의 변경시 이유는 Info Message의 변경시에만 변경 이유를 갖는다</span></div><div class="line">    <span class="keyword">final</span> PagerDutyDto.Request request = buildInfoMessage();</div><div class="line">    send(request);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">private</span> PagerDutyDto.<span class="function">Response <span class="title">send</span><span class="params">(<span class="keyword">final</span> PagerDutyDto.Request request)</span> </span>&#123;</div><div class="line">    <span class="comment">// 넘겨 받은 request를 PagerDuty 에게 보내는 책임</span></div><div class="line">    <span class="comment">// 해당 메소드의 변경시 이유는 PagerDuty API 변경시만 변경 이유를 갖는다. -&gt; Request, Response 변경이 대표적인 예</span></div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        <span class="keyword">final</span> String url = <span class="string">"https://events.pagerduty.com/v2/enqueue"</span>;</div><div class="line">        <span class="keyword">return</span> restTemplate.postForObject(url, request, PagerDutyDto.Response.class);</div><div class="line">    &#125; <span class="keyword">catch</span> (HttpClientErrorException e) &#123;</div><div class="line">        log.error(e.getResponseBodyAsString(), e);</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><blockquote><p>클린 코드 출처</p><p><strong>작게 만들어라!</strong></p><p>함수를 만드는 첫 번째 규칙은 '작게!'다. 함수를 만드는 둘째 규칙은 '더 작게!'다. …중략<br><strong>한 가지만 해라!</strong></p><p>함수는 한 가지를 해야 한다. 그 한 가지를 잘해야 한다. 그 한 가지만을 해야 한다. … 중략</p></blockquote><p><strong>클린 코드에서 언급했듯이 함수의 기본단위는 정말 작아야 한다고 생각합니다. 그래야 재사용성이 높아지며 가독성, 유지보수에 좋은 코드가 된다고 생각합니다.</strong></p><p>sendErrorMessage() 메소드는 적절하게 Error Message를 만들어서 send 메소드에게 전달해주는 것이 그 함수가 하는 일입니다. 함수의 크기가 작으며 적은 일을 수행하고 있습니다.</p><p>send() 메소드도 넘겨받은 request값을 PagerDutry API 에게 요청하고 그에 따른 응답값을 받는 일만 합니다. 그렇게 된 결과 sendInfoMessage() 메서드에서도 재사용성이 높아지고, 해당 함수가 하는 일이 단순해져서 가독성이 높아집니다. 또 위에서도 언급했듯이 PagerDuty API 변경시에만 해당 메소드가 변경됩니다. 그런 결과 유지 보수하기 편한 이점이 있다고 생각합니다.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;예제 코드는 &lt;a href=&quot;https://github.com/cheese10yun/blog-sample/tree/master/pagerduty&quot; rel=&quot;external nofollow noopener noreferrer&quot; target=&quot;_bl
      
    
    </summary>
    
    
      <category term="Spring" scheme="https://cheese10yun.github.io/tags/Spring/"/>
    
      <category term="OOP" scheme="https://cheese10yun.github.io/tags/OOP/"/>
    
  </entry>
  
  <entry>
    <title>Spring-Jpa Best Practices Step-08 - OneToOne 관계 설정 팁</title>
    <link href="https://cheese10yun.github.io/spring-jpa-best-08/"/>
    <id>https://cheese10yun.github.io/spring-jpa-best-08/</id>
    <published>2018-06-28T15:00:00.000Z</published>
    <updated>2018-06-29T10:51:56.290Z</updated>
    
    <content type="html"><![CDATA[<p>해당 코드는 <a href="https://github.com/cheese10yun/spring-jpa-best-practices" rel="external nofollow noopener noreferrer" target="_blank">Github</a>를 확인해주세요.</p><p>OneToOne 관계 설정 시에 간단한 팁을 정리하겠습니다. 해당 객체들의 성격은 다음과 같습니다.</p><ul><li>주문과 쿠폰 엔티티가 있다.</li><li>주문 시 쿠폰을 적용해서 할인받을 수 있다.</li><li>주문과 쿠폰 관계는 1:1 관계 즉 OneToOne 관계이다.</li></ul><p>주의 깊게 살펴볼 내용은 다음과 같습니다.</p><ul><li>외래 키는 어디 테이블에 두는 것이 좋은가?</li><li>양방향 연관 관계 편의 메소드</li><li>제약 조건으로 인한 안정성 및 성능 향상</li></ul><h2><span id="entity-객체">Entity 객체</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Coupon</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Id</span></div><div class="line">    <span class="meta">@GeneratedValue</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">long</span> id;</div><div class="line"></div><div class="line">    <span class="meta">@Column</span>(name = <span class="string">"discount_amount"</span>)</div><div class="line">    <span class="keyword">private</span> <span class="keyword">double</span> discountAmount;</div><div class="line"></div><div class="line">    <span class="meta">@Column</span>(name = <span class="string">"use"</span>)</div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> use;</div><div class="line"></div><div class="line">    <span class="meta">@OneToOne</span>()</div><div class="line">    <span class="keyword">private</span> Order order;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Order</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Id</span></div><div class="line">    <span class="meta">@GeneratedValue</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">long</span> id;</div><div class="line">    </div><div class="line">    <span class="meta">@Column</span>(name = <span class="string">"price"</span>)</div><div class="line">    <span class="keyword">private</span> <span class="keyword">double</span> price;</div><div class="line"></div><div class="line">    <span class="meta">@OneToOne</span></div><div class="line">    <span class="meta">@JoinColumn</span>()</div><div class="line">    <span class="keyword">private</span> Coupon coupon;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2><span id="외래-키는-어디-테이블에-두는-것이-좋은가">외래 키는 어디 테이블에 두는 것이 좋은가?</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Order 가연관관계의 주인일 경우</span></div><div class="line"><span class="meta">@OneToOne</span></div><div class="line"><span class="meta">@JoinColumn</span>(name = <span class="string">"coupon_id"</span>, referencedColumnName = <span class="string">"id"</span>)</div><div class="line"><span class="keyword">private</span> Coupon coupon;</div><div class="line"></div><div class="line"><span class="meta">@OneToOne</span>(mappedBy = <span class="string">"coupon"</span>)</div><div class="line"><span class="keyword">private</span> Order order;</div><div class="line"></div><div class="line"><span class="comment">// coupon이 연관관계의 주인일 경우 </span></div><div class="line"><span class="meta">@OneToOne</span>(mappedBy = <span class="string">"order"</span>)</div><div class="line"><span class="keyword">private</span> Coupon coupon;</div><div class="line"></div><div class="line"><span class="meta">@OneToOne</span></div><div class="line"><span class="meta">@JoinColumn</span>(name = <span class="string">"order_id"</span>, referencedColumnName = <span class="string">"id"</span>)</div><div class="line"><span class="keyword">private</span> Order order;</div></pre></td></tr></table></figure><p>일대다 관계에서는 다 쪽에서 외래 키를 관리 하게 되지만 상대적으로 일대일 관계 설정에는 외래 키를 어느 곳에 두어야 하는지를 생각을 해야 합니다. JPA 상에서는 외래 키가 갖는 쪽이 연관 관계의 주인이 되고<br><strong>연관 관계의 주인만이 데이터베이스 연관 관계와 매핑되고 왜래 키를 관리(등록, 수정, 삭제)할 수 있기 때문입니다.</strong></p><h2><span id="sample-code">Sample Code</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 주문시 1,000 할인 쿠폰을 적용해본 간단한 코드입니다. </span></div><div class="line"><span class="function"><span class="keyword">public</span> Order <span class="title">order</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">final</span> Order order = Order.builder().price(<span class="number">1_0000</span>).build(); <span class="comment">// 10,000 상품주문</span></div><div class="line">    Coupon coupon = couponService.findById(<span class="number">1</span>); <span class="comment">// 1,000 할인 쿠폰</span></div><div class="line">    order.applyCoupon(coupon);</div><div class="line">    <span class="keyword">return</span> orderRepository.save(order);</div><div class="line">&#125;</div><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> order_쿠폰할인적용() &#123;</div><div class="line">    <span class="keyword">final</span> Order order = orderService.order();</div><div class="line">    assertThat(order.getPrice(), is(<span class="number">9_000</span>D)); <span class="comment">// 1,000 할인 적용 확인</span></div><div class="line"></div><div class="line">    <span class="keyword">final</span> Order findOrder = orderService.findOrder(order.getId());</div><div class="line">    System.out.println(<span class="string">"couponId : "</span>+ findOrder.getCoupon().getId()); <span class="comment">// couponId : 1 (coupon_id 외래 키를 저장 완료)</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><h3><span id="order가-주인일-경우-장점-insert-sql이-한번-실행">Order가 주인일 경우 장점 : INSERT SQL이 한번 실행</span></h3><p><img src="https://i.imgur.com/k6V64ye.png" alt=""></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">// order가 연관 관계의 주인일 경우 SQL</div><div class="line"><span class="keyword">insert</span> <span class="keyword">into</span> orders (<span class="keyword">id</span>, coupon_id, price) <span class="keyword">values</span> (<span class="literal">null</span>, ?, ?) </div><div class="line"></div><div class="line">//coupon이 연관 관계의 주인일 경우 <span class="keyword">SQL</span></div><div class="line"><span class="keyword">insert</span> <span class="keyword">into</span> orders (<span class="keyword">id</span>, price) <span class="keyword">values</span> (<span class="literal">null</span>, ?)</div><div class="line"><span class="keyword">update</span> coupon <span class="keyword">set</span> discount_amount=?, order_id=?, <span class="keyword">use</span>=? <span class="keyword">where</span> <span class="keyword">id</span>=?</div></pre></td></tr></table></figure><p>order 테이블에 coupon_id 칼럼을 저장하기 때문에 주문 SQL은 한 번만 실행됩니다. 반면에 coupon이 연관 관계의 주인일 경우에는 coupon에 order의 외래 키가 있으니 order INSERT SQL 한 번, coupon 테이블에 order_id 칼럼 업데이트 쿼리 한번 총 2번의 쿼리가 실행됩니다.</p><p>작은 장점으로는 데이터베이스 칼럼에 coupon_id 항목이 null이 아닌 경우 할인 쿠폰이 적용된 것으로 판단할 수 있습니다.</p><h3><span id="order가-주인일-경우-단점-연관-관계-변경-시-취약">Order가 주인일 경우 단점 : 연관 관계 변경 시 취약</span></h3><p>기존 요구사항은 주문 한 개에 쿠폰은 한 개만 적용 이 가는 했기 때문에 OneToOne 연관 관계를 맺었지만  <strong>하나의 주문에 여러 개의 쿠폰이 적용되는 기능이 추가되었을 때 변경하기 어렵다는 단점이 있습니다.</strong></p><p>order 테이블에 coupon_id 칼럼을 갖고 있어서 여러 개의 쿠폰을 적용하기 위해서는 coupon 테이블에서 order_id 칼럼을 가진 구조로 변경 해야 합니다. <strong>OneToMany 관계에서는 연관 관계의 주인은 왜래 키를 갖는 엔티티가 갖는 것이 바람직합니다.</strong> 비즈니스 로직 변경은 어려운 게 없으나 데이터베이스 칼럼들을 이전 해야 하기 때문에 실제 서비스 중인 프로젝트에는 상당히 골치 아프게 됩니다.</p><p>장점이 단점이 되고 단점이 장점이 되기 때문에 Coupon 장단점을 정리하지 않았습니다.</p><h2><span id="연관-관계의-주인-설정">연관 관계의 주인 설정</span></h2><p>OneToOne 관계를 맺으면 외래 키를 어디에 둘 것인지, 즉 연관 관계의 주인을 어디에 둘 것인지는 많은 고민이 필요 합니다. 제 개인적인 생각으로는 OneToMany로 변경될 가능성이 있는지를 판단하고 변경이 될 가능성이 있다고 판단되면 Many가 될 엔티티가 관계의 주인이 되는 것이 좋다고 봅니다. 또 애초에 OneToMany를 고려해서 초기 관계 설정을 OneToMany로 가져가는 것도 좋다고 생각합니다.</p><p>그러니 이 연관 관계가 정말 OneToOne 관계인지 깊은 고민이 필요하고 해당 도메인에 대한 지식도 필요 하다고 생각합니다. 예를 들어 개인 송금 관계에서 입금 &amp;amplt-&amp;ampgt 출금 관계를 가질 경우 반드시 하나의 입금 당 하나의 출금을 갖게 되니 이것은 OneToOne 관계로 맺어가도 무리가 없다고 판단됩니다. (물론 아닌 때도 있습니다. 그래서 해당 도메인에 대한 지식이 필요 한다고 생각합니다)</p><p><strong>주인 설정이라고 하면 뭔가 더 중요한 것이 주인이 되어야 할 거 같다는 생각이 들지만 연관 관계의 주인이라는 것은 왜래 키의 위치와 관련해서 정해야 하지 해당 도메인의 중요성과는 상관관계가 없습니다.</strong></p><h2><span id="양방향-연관관계-편의-메소드">양방향 연관관계 편의 메소드</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Order가 연관관계의 주인일 경우 예제</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Coupon</span> </span>&#123;</div><div class="line">    ...</div><div class="line">    <span class="comment">// 연관관계 편의 메소드</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">use</span><span class="params">(<span class="keyword">final</span> Order order)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.order = order;</div><div class="line">        <span class="keyword">this</span>.use = <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Order</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> Coupon coupon; <span class="comment">//(1)</span></div><div class="line">    ...</div><div class="line">    <span class="comment">// 연관관계 편의 메소드</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">applyCoupon</span><span class="params">(<span class="keyword">final</span> Coupon coupon)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.coupon = coupon;</div><div class="line">        coupon.use(<span class="keyword">this</span>);</div><div class="line">        price -= coupon.getDiscountAmount();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 주문 생성시 1,000 할인 쿠폰 적용</span></div><div class="line"><span class="function"><span class="keyword">public</span> Order <span class="title">order</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">final</span> Order order = Order.builder().price(<span class="number">1_0000</span>).build(); <span class="comment">// 10,000 상품주문</span></div><div class="line">    Coupon coupon = couponService.findById(<span class="number">1</span>); <span class="comment">// 1,000 할인 쿠폰</span></div><div class="line">    order.applyCoupon(coupon);</div><div class="line">    <span class="keyword">return</span> orderRepository.save(order);</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>연관 관계의 주인이 해당 참조할 객체를 넣어줘야 데이터베이스의 칼럼에 외래 키가 저장됩니다. 즉 Order가 연관 관계의 주인이면 (1)번 멤버 필드에 Coupon을 넣어줘야 데이터베이스 order 테이블에 coupon_id 칼럼에 저장됩니다.</p><p>양방향 연관 관계일 경우 위처럼 연관 관계 편의 메소드를 작성하는 것이 좋습니다. 위에서 말했듯이 연관 관계의 주인만이 왜래 키를 관리 할 수 있으니 applyCoupon 메소드는 이해하는데 어렵지 않습니다.</p><p>그렇다면 use 메서드에서에 데이터베이스에 저장하지도 않는 Order를 set을 왜 해주는 걸까요?</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">use</span><span class="params">(<span class="keyword">final</span> Order order)</span> </span>&#123;</div><div class="line"><span class="comment">//  this.order = order; 해당코드를 주석했을 때 테스트 코드</span></div><div class="line">    <span class="keyword">this</span>.use = <span class="keyword">true</span>;</div><div class="line">&#125; </div><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> use_메서드에_order_set_필요이유() &#123;</div><div class="line">    <span class="keyword">final</span> Order order = orderService.order();</div><div class="line">    assertThat(order.getPrice(), is(<span class="number">9_000</span>D)); <span class="comment">// 1,000 할인 적용 확인</span></div><div class="line">    <span class="keyword">final</span> Coupon coupon = order.getCoupon();</div><div class="line">    assertThat(coupon.getOrder(), is(notNullValue())); <span class="comment">// 해당 검사는 실패한다.</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><p>order를 바인딩하는 코드를 주석하고 해당 코드를 돌려보면 실패하게 됩니다. 일반적으로 생각했을 때 order 생성 시 1,000할인 쿠폰을 적용했기 때문에 해당 쿠폰에도 주문 객체가 들어갔을 거로 생각할 수 있습니다. 하지만 위의 주석시킨 코드가 그 기능을 담당했기 때문에 쿠폰 객체의 주문 값은 null인 상태입니다. <strong>즉 순수한 객체까지 고려한 양방향 관계를 고려하는 것이 바람직하고 그것이 안전합니다.</strong></p><h2><span id="제약-조건으로-인한-안정-성-및-성능-향상">제약 조건으로 인한 안정 성 및 성능 향상</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Order</span> </span>&#123;</div><div class="line">    ...</div><div class="line"></div><div class="line">    <span class="meta">@OneToOne</span></div><div class="line">    <span class="meta">@JoinColumn</span>(name = <span class="string">"coupon_id"</span>, referencedColumnName = <span class="string">"id"</span>, nullable = <span class="keyword">false</span>)</div><div class="line">    <span class="keyword">private</span> Coupon coupon;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>모든 주문에 할인 쿠폰이 적용된다면 @JoinColumn의 nullable 옵션을 false로 주는 것이 좋습니다. <strong>NOT NULL 제약 조건을 준수해서 안전성이 보장됩니다.</strong></p><p><img src="https://i.imgur.com/bHfKh8m.png" alt=""></p><ul><li>nullable = false 없는 경우, outer join</li></ul><p><img src="https://i.imgur.com/94To549.png" alt=""></p><ul><li>nullable = false 선언한 경우, inner join</li></ul><p><strong>외래 키에 NOT NULL 제약 조건을 설정하면 값이 있는 것을 보장합니다. 따라서 JPA는 이때 내부조인을<br>통해서 내부 조인 SQL을 만들어 주고 이것은 외부 조인보다 성능과 최적화에 더 좋습니다.</strong></p><p>물론 모든 경우에 적용할 수는 없고 반드시 외래 키가 NOT NULL인 조건에만 사용할 수 있습니다. 예를 들어 쿠폰과 회원 연관 관계가 있을 때 쿠폰은 반드시 회원의 외래 키를 참조하고 있어야 합니다. 이런 경우 유용하게 사용할 수 있습니다.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;해당 코드는 &lt;a href=&quot;https://github.com/cheese10yun/spring-jpa-best-practices&quot; rel=&quot;external nofollow noopener noreferrer&quot; target=&quot;_blank&quot;&gt;Git
      
    
    </summary>
    
    
      <category term="Spring" scheme="https://cheese10yun.github.io/tags/Spring/"/>
    
      <category term="JPA" scheme="https://cheese10yun.github.io/tags/JPA/"/>
    
      <category term="Best Practices" scheme="https://cheese10yun.github.io/tags/Best-Practices/"/>
    
  </entry>
  
  <entry>
    <title>Jackson 어노테이션 사용법(5)</title>
    <link href="https://cheese10yun.github.io/jackson-annotation-05/"/>
    <id>https://cheese10yun.github.io/jackson-annotation-05/</id>
    <published>2018-06-22T15:00:00.000Z</published>
    <updated>2018-06-22T15:13:59.757Z</updated>
    
    <content type="html"><![CDATA[<h2><span id="custom-jackson-annotation-disable-jackson-annotation">Custom Jackson Annotation, Disable Jackson Annotation</span></h2><ul><li><a href="http://www.baeldung.com/jackson-annotations" rel="external nofollow noopener noreferrer" target="_blank">Jackson Annotation Examples</a> 예제를 적용전, 적용후로 나누어서 정리 해봤습니다.</li><li>테스트코드도 참고하시면 좋습니다.</li><li>해당 코드 및 전체 Jackson 정리는 <a href="https://github.com/cheese10yun/blog-sample/tree/master/jackson" rel="external nofollow noopener noreferrer" target="_blank">Github</a>를 참고해주세요</li></ul><h2><span id="custom-jackson-annotation">Custom Jackson Annotation</span></h2><ul><li>Annotation 직접 정리 할 수 있습니다.</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@CustomAnnotation</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanWithCustomAnnotation</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</div><div class="line">    <span class="keyword">public</span> String name;</div><div class="line">    <span class="keyword">public</span> Date dateCreated;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BeanWithCustomAnnotation</span><span class="params">(<span class="keyword">int</span> id, String name, Date dateCreated)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.id = id;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">        <span class="keyword">this</span>.dateCreated = dateCreated;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</div><div class="line"><span class="meta">@JacksonAnnotationsInside</span></div><div class="line"><span class="meta">@JsonInclude</span>(JsonInclude.Include.NON_NULL)</div><div class="line"><span class="meta">@JsonPropertyOrder</span>(&#123;<span class="string">"name"</span>, <span class="string">"id"</span>, <span class="string">"dateCreated"</span>&#125;)</div><div class="line"><span class="meta">@interface</span> CustomAnnotation &#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">// 적용전</div><div class="line">&#123;</div><div class="line">  <span class="attr">"id"</span>: <span class="number">1</span>,</div><div class="line">  <span class="attr">"name"</span>: <span class="string">"My bean"</span>,</div><div class="line">  <span class="attr">"dateCreated"</span>: <span class="literal">null</span></div><div class="line">&#125;</div><div class="line">// 적용후, property order 변경, null 값 비 직렬화</div><div class="line">&#123;</div><div class="line">  <span class="attr">"name"</span>: <span class="string">"My bean"</span>,</div><div class="line">  <span class="attr">"id"</span>: <span class="number">1</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><h2><span id="disable-jackson-annotation">Disable Jackson Annotation</span></h2><ul><li>모든 Jackson annotation 비활성화 하는 방법</li></ul> <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@JsonInclude</span>(JsonInclude.Include.NON_NULL)</div><div class="line"><span class="meta">@JsonPropertyOrder</span>(&#123;<span class="string">"name"</span>, <span class="string">"id"</span>&#125;)</div><div class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</div><div class="line">     <span class="keyword">public</span> <span class="keyword">int</span> id;</div><div class="line">     <span class="keyword">public</span> String name;</div><div class="line"></div><div class="line">     <span class="function"><span class="keyword">public</span> <span class="title">MyBean</span><span class="params">(<span class="keyword">int</span> id, String name)</span> </span>&#123;</div><div class="line">         <span class="keyword">this</span>.id = id;</div><div class="line">         <span class="keyword">this</span>.name = name;</div><div class="line">     &#125;</div><div class="line"> &#125;</div><div class="line">mapper.disable(MapperFeature.USE_ANNOTATIONS); <span class="comment">// 모든 Jackson annotation 비활성화</span></div></pre></td></tr></table></figure> <figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">// MapperFeature.USE_ANNOTATIONS 적용전</div><div class="line">&#123;</div><div class="line">    <span class="attr">"id"</span>:<span class="number">1</span>,</div><div class="line">    <span class="attr">"name"</span>:<span class="literal">null</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">// MapperFeature.USE_ANNOTATIONS 적용후</div><div class="line">&#123;</div><div class="line">  <span class="attr">"id"</span>: <span class="number">1</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2&gt;&lt;span id=&quot;custom-jackson-annotation-disable-jackson-annotation&quot;&gt;Custom Jackson Annotation, Disable Jackson Annotation&lt;/span&gt;&lt;/h2&gt;
&lt;ul&gt;
&lt;
      
    
    </summary>
    
    
      <category term="Jackson" scheme="https://cheese10yun.github.io/tags/Jackson/"/>
    
  </entry>
  
  <entry>
    <title>Jackson 어노테이션 사용법(4)</title>
    <link href="https://cheese10yun.github.io/jackson-annotation-04/"/>
    <id>https://cheese10yun.github.io/jackson-annotation-04/</id>
    <published>2018-06-19T15:00:00.000Z</published>
    <updated>2018-06-20T13:50:28.134Z</updated>
    
    <content type="html"><![CDATA[<h2><span id="polymorphic-type-handling-annotations-general-annotations">Polymorphic Type Handling Annotations,  General Annotations</span></h2><ul><li><a href="http://www.baeldung.com/jackson-annotations" rel="external nofollow noopener noreferrer" target="_blank">Jackson Annotation Examples</a> 예제를 적용전, 적용후로 나누어서 정리 해봤습니다.</li><li>테스트코드도 참고하시면 좋습니다.</li><li>해당 코드 및 전체 Jackson 정리는 <a href="https://github.com/cheese10yun/blog-sample/tree/master/jackson" rel="external nofollow noopener noreferrer" target="_blank">Github</a>를 참고해주세요</li></ul><h2><span id="jackson-polymorphic-type-handling-annotations">Jackson Polymorphic Type Handling Annotations</span></h2><ul><li>Polymorphic을 통한 직렬화, 비직렬화</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@NoArgsConstructor</span>(access = AccessLevel.PRIVATE)</div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Zoo</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> Animal animal;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Zoo</span><span class="params">(Animal animal)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.animal = animal;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@JsonTypeInfo</span>(</div><div class="line">            use = JsonTypeInfo.Id.NAME,</div><div class="line">            include = JsonTypeInfo.As.PROPERTY,</div><div class="line">            property = <span class="string">"type"</span>)</div><div class="line">    <span class="meta">@JsonSubTypes</span>(&#123;</div><div class="line">            <span class="meta">@JsonSubTypes</span>.Type(value = Dog.class, name = <span class="string">"dog"</span>),</div><div class="line">            <span class="meta">@JsonSubTypes</span>.Type(value = Cat.class, name = <span class="string">"cat"</span>)</div><div class="line">    &#125;)</div><div class="line">    <span class="meta">@Getter</span></div><div class="line">    <span class="meta">@NoArgsConstructor</span>(access = AccessLevel.PRIVATE)</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</div><div class="line">        <span class="keyword">private</span> String name;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Animal</span><span class="params">(String name)</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.name = name;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@JsonTypeName</span>(<span class="string">"dog"</span>)</div><div class="line">    <span class="meta">@Getter</span></div><div class="line">    <span class="meta">@NoArgsConstructor</span>(access = AccessLevel.PRIVATE)</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</div><div class="line">        <span class="keyword">public</span> <span class="keyword">double</span> barkVolume;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Dog</span><span class="params">(String name)</span> </span>&#123;</div><div class="line">            <span class="keyword">super</span>(name);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@JsonTypeName</span>(<span class="string">"cat"</span>)</div><div class="line">    <span class="meta">@Getter</span></div><div class="line">    <span class="meta">@NoArgsConstructor</span>(access = AccessLevel.PRIVATE)</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Cat</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</div><div class="line">        <span class="keyword">boolean</span> likesCream;</div><div class="line">        <span class="keyword">public</span> <span class="keyword">int</span> lives;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Cat</span><span class="params">(String name)</span> </span>&#123;</div><div class="line">            <span class="keyword">super</span>(name);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"animal"</span>: &#123;</div><div class="line">        <span class="attr">"type"</span>: <span class="string">"dog"</span>,</div><div class="line">        <span class="attr">"name"</span>: <span class="string">"lacy"</span>,</div><div class="line">        <span class="attr">"barkVolume"</span>: <span class="number">0</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">&#123;</div><div class="line">    <span class="attr">"animal"</span>:&#123;</div><div class="line">        <span class="attr">"name"</span>:<span class="string">"lacy"</span>,</div><div class="line">        <span class="attr">"type"</span>:<span class="string">"cat"</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2><span id="jackson-general-annotations">Jackson General Annotations</span></h2><h3><span id="jsonformat">@JsonFormat</span></h3><ul><li>날짜 / 시간 값을 직렬화 할 때 포멧팅을 지정합니다</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Event</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> String name;</div><div class="line"></div><div class="line">    <span class="meta">@JsonFormat</span>(</div><div class="line">            shape = JsonFormat.Shape.STRING,</div><div class="line">            pattern = <span class="string">"dd-MM-yyyy hh:mm:ss"</span>)</div><div class="line">    <span class="keyword">public</span> Date eventDate;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Event</span><span class="params">(String name, Date date)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">        <span class="keyword">this</span>.eventDate = date;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">//적용전</div><div class="line">&#123;</div><div class="line">  <span class="attr">"name"</span>:<span class="string">"party"</span>,</div><div class="line">  <span class="attr">"eventDate"</span>:<span class="number">1419042600000</span></div><div class="line">&#125;</div><div class="line">//적용후</div><div class="line">&#123;</div><div class="line">  <span class="attr">"name"</span>: <span class="string">"party"</span>,</div><div class="line">  <span class="attr">"eventDate"</span>: <span class="string">"20-12-2014 02:30:00"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><h3><span id="jsonunwrapped">@JsonUnwrapped</span></h3><ul><li>직렬화, 비 직렬화 될 때 언 래핑 / 병합되어야 하는 값 을 정의하는 데 사용됩니다</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">UnwrappedUser</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</div><div class="line"></div><div class="line">    <span class="meta">@JsonUnwrapped</span></div><div class="line">    <span class="keyword">public</span> Name name;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UnwrappedUser</span><span class="params">(<span class="keyword">int</span> id, Name name)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.id = id;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Name</span> </span>&#123;</div><div class="line">        <span class="keyword">public</span> String firstName;</div><div class="line">        <span class="keyword">public</span> String lastName;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Name</span><span class="params">(String firstName, String lastName)</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.firstName = firstName;</div><div class="line">            <span class="keyword">this</span>.lastName = lastName;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">//적용전</div><div class="line">&#123;</div><div class="line">  <span class="attr">"id"</span>: <span class="number">1</span>,</div><div class="line">  <span class="attr">"firstName"</span>: <span class="string">"John"</span>,</div><div class="line">  <span class="attr">"lastName"</span>: <span class="string">"Doe"</span></div><div class="line">&#125;</div><div class="line">//적용후</div><div class="line">&#123;</div><div class="line">  <span class="attr">"id"</span>:<span class="number">1</span>,</div><div class="line">  <span class="attr">"name"</span>:&#123;</div><div class="line">    <span class="attr">"firstName"</span>:<span class="string">"John"</span>,</div><div class="line">    <span class="attr">"lastName"</span>:<span class="string">"Doe"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h3><span id="jsonview">@JsonView</span></h3><ul><li>속성이 serialization / deserialization에 포함될 View 를 나타내는 데 사용됩니다.</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Views</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Public</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Internal</span> <span class="keyword">extends</span> <span class="title">Public</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Item</span> </span>&#123;</div><div class="line">    <span class="meta">@JsonView</span>(Views.Public.class)</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</div><div class="line"></div><div class="line">    <span class="meta">@JsonView</span>(Views.Public.class)</div><div class="line">    <span class="keyword">public</span> String itemName;</div><div class="line"></div><div class="line">    <span class="meta">@JsonView</span>(Views.Internal.class)</div><div class="line">    <span class="keyword">public</span> String ownerName;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Item</span><span class="params">(<span class="keyword">int</span> id, String itemName, String ownerName)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.id = id;</div><div class="line">        <span class="keyword">this</span>.itemName = itemName;</div><div class="line">        <span class="keyword">this</span>.ownerName = ownerName;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">//적용전</div><div class="line">&#123;</div><div class="line">  <span class="attr">"id"</span>:<span class="number">2</span>,</div><div class="line">  <span class="attr">"itemName"</span>:<span class="string">"book"</span>,</div><div class="line">  <span class="attr">"ownerName"</span>:<span class="string">"John"</span></div><div class="line">&#125;</div><div class="line">//적용후</div><div class="line">&#123;</div><div class="line">  <span class="attr">"id"</span>:<span class="number">2</span>,</div><div class="line">  <span class="attr">"itemName"</span>:<span class="string">"book"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><h3><span id="jsonmanagedreference-jsonbackreference">@JsonManagedReference, @JsonBackReference</span></h3><ul><li>객체의  상위 / 하위 관계를 처리 명시하고 무한 순함참조에러를 해결합니다.</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemWithRef</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</div><div class="line">    <span class="keyword">public</span> String itemName;</div><div class="line"></div><div class="line">    <span class="meta">@JsonManagedReference</span></div><div class="line">    <span class="keyword">public</span> UserWithRef owner;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ItemWithRef</span><span class="params">(<span class="keyword">int</span> id, String itemName, UserWithRef owner)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.id = id;</div><div class="line">        <span class="keyword">this</span>.itemName = itemName;</div><div class="line">        <span class="keyword">this</span>.owner = owner;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">UserWithRef</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</div><div class="line">    <span class="keyword">public</span> String name;</div><div class="line"></div><div class="line">    <span class="meta">@JsonBackReference</span></div><div class="line">    <span class="keyword">public</span> List&lt;ItemWithRef&gt; itemWithRefs = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserWithRef</span><span class="params">(<span class="keyword">int</span> id, String name)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.id = id;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addItem</span><span class="params">(ItemWithRef item)</span> </span>&#123;</div><div class="line">        itemWithRefs.add(item);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">//적용전</div><div class="line">// Infinite recursion (StackOverflowError)... 무한 순함참조 에러</div><div class="line">//적용후</div><div class="line">&#123;</div><div class="line">  <span class="attr">"id"</span>:<span class="number">2</span>,</div><div class="line">  <span class="attr">"itemName"</span>:<span class="string">"book"</span>,</div><div class="line">  <span class="attr">"owner"</span>:&#123;</div><div class="line">    <span class="attr">"id"</span>:<span class="number">1</span>,</div><div class="line">    <span class="attr">"name"</span>:<span class="string">"John"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h3><span id="jsonfilter">@JsonFilter</span></h3><ul><li>직렬화시에 사용되는 필터를 지정합니다.</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@JsonFilter</span>(<span class="string">"myFilter"</span>)</div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanWithFilter</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</div><div class="line">    <span class="keyword">public</span> String name;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BeanWithFilter</span><span class="params">(<span class="keyword">int</span> id, String name)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.id= id;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">//적용전</div><div class="line">&#123;</div><div class="line">  <span class="attr">"id"</span>:<span class="number">1</span>,</div><div class="line">  <span class="attr">"name"</span>:<span class="string">"My bean"</span></div><div class="line">&#125;</div><div class="line">//적용후</div><div class="line">&#123;</div><div class="line">  <span class="attr">"name"</span>:<span class="string">"My bean"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2&gt;&lt;span id=&quot;polymorphic-type-handling-annotations-general-annotations&quot;&gt;Polymorphic Type Handling Annotations,  General Annotations&lt;/span&gt;&lt;
      
    
    </summary>
    
    
      <category term="Jackson" scheme="https://cheese10yun.github.io/tags/Jackson/"/>
    
  </entry>
  
  <entry>
    <title>Spring-Jpa Best Practices Step-07 - Embedded를 적극 활용</title>
    <link href="https://cheese10yun.github.io/spring-jpa-best-07/"/>
    <id>https://cheese10yun.github.io/spring-jpa-best-07/</id>
    <published>2018-06-13T15:00:00.000Z</published>
    <updated>2018-06-22T15:25:51.374Z</updated>
    
    <content type="html"><![CDATA[<p>해당 코드는 <a href="https://github.com/cheese10yun/spring-jpa-best-practices" rel="external nofollow noopener noreferrer" target="_blank">Github</a>를 확인해주세요.</p><p>Embedded을 사용하면 칼럼들을 자료형으로 규합해서 응집력 및 재사용성을 높여 훨씬 더 객체지향 프로그래밍을 할 수 있게 도울 수 있습니다. Embedded은 다음과 같은 장점들이 있습니다.</p><h2><span id="자료형의-통일">자료형의 통일</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Account</span> </span>&#123;</div><div class="line">    <span class="comment">// 단순 String</span></div><div class="line">    <span class="meta">@email</span></div><div class="line">    <span class="meta">@Column</span>(name = <span class="string">"email"</span>, nullable = <span class="keyword">false</span>, unique = <span class="keyword">true</span>)</div><div class="line">    <span class="keyword">private</span> String email;</div><div class="line"></div><div class="line">    <span class="comment">// Email 자료형 </span></div><div class="line">    <span class="meta">@Embedded</span></div><div class="line">    <span class="keyword">private</span> Email email;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Email</span> </span>&#123;</div><div class="line">    <span class="meta">@Email</span></div><div class="line">    <span class="meta">@Column</span>(name = <span class="string">"email"</span>, nullable = <span class="keyword">false</span>, unique = <span class="keyword">true</span>)</div><div class="line">    <span class="keyword">private</span> String value;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>위처럼 단순 String 자료형에서 Email 자로 형으로 통일이 됩니다. <strong>자료형이 통일되면 많은 더욱 안전성이 높아지는 효과가 있습니다.</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> Account <span class="title">findByEmail</span><span class="params">(<span class="keyword">final</span> Email email)</span> </span>&#123; <span class="comment">//단순 문자열일 경우 (final String email)</span></div><div class="line">    <span class="keyword">final</span> Account account = accountRepository.findByEmail(email);</div><div class="line">    <span class="keyword">if</span> (account == <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> AccountNotFoundException(email);</div><div class="line">    <span class="keyword">return</span> account;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>이메일로 회원을 조회 할 때 단순 문자열일 경우에는 굳이 이메일 형식을 맞추지 않고도 단순 문자열을 통해서 조회할 수 있습니다. 이것은 편하게 느껴질지는 모르나 안전성에는 좋다고 생각하지 않습니다. 위처럼 정확한 이메일 자료형으로 조회가 가능하게 안전성을 높일 수 있습니다. <strong>위처럼 단순 조회용뿐만이 아니라 Email에 관련된 모든 자료형을 단순 String에서 Email로 변경함으로써 얻을 수 있는 이점은 많습니다.</strong></p><h2><span id="풍부한-객체-rich-obejct">풍부한 객체 (Rich Obejct)</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Email</span> </span>&#123;</div><div class="line">    ...</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getHost</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> index = value.indexOf(<span class="string">"@"</span>);</div><div class="line">        <span class="keyword">return</span> value.substring(index);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getId</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> index = value.indexOf(<span class="string">"@"</span>);</div><div class="line">        <span class="keyword">return</span> value.substring(<span class="number">0</span>, index);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>이메일 아이디와 호스트값을 추출해야 하는 기능이 필요해질 경우 기존 String 자로 형일 경우에는 해당 로직을 Account 도메인 객체에 추가하든, 유틸성 클래스에 추가하든 해야 합니다.</p><p>도메인 객체에 추가할 때는 Account 도메인 클래스가 갖는 책임들이 많아집니다. 또 이메일은 어디서든지 사용할 수 있는데 Account 객체에서 이 기능을 정의하는 것은 올바르지 않습니다.</p><p>유틸성 클래스에 추가하는 것 또한 좋지 않아 보입니다. 일단 유틸성 클래스에 해당 기능이 있는지 알아봐야 하고 기능이 있음에도 불구하고 그것을 모르고 추가하여 중복 코가 발생하는 일이 너무나도 흔하게 발생합니다.</p><p>이것을 Email 형으로 빼놓았다면 아래처럼 Email 객체를 사용하는 곳 어디든지 사용할 수 있습니다. 해당 기능은 Email 객체가 해야 하는 일이고 또 그 일을 가장 잘할 수 있는 객체입니다. 또 한 코드가 아주 이해하기 쉽게 됩니다. 객체의 기능이 풍부해집니다.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">email.getHost();</div><div class="line">email.getId());</div></pre></td></tr></table></figure><h2><span id="재사용성">재사용성</span></h2><p>가령 해외 송금을 하는 기능이 있다고 가정할 경우 Remittance 클래스는 보내는 금액, 나라, 통화, 받는 금액, 나라, 통화가 필요하다. 이처럼 도메인이 복잡해질수록 더 재사용성은 중요합니다.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Remittance</span></span>&#123;</div><div class="line">    <span class="comment">//자료형이 없는 경우</span></div><div class="line">    <span class="meta">@Column</span>(name = <span class="string">"send_amount"</span>) <span class="keyword">private</span> <span class="keyword">double</span> sendAamount;</div><div class="line">    <span class="meta">@Column</span>(name = <span class="string">"send_country"</span>) <span class="keyword">private</span> String sendCountry;</div><div class="line">    <span class="meta">@Column</span>(name = <span class="string">"send_currency"</span>) <span class="keyword">private</span> String sendCurrency;</div><div class="line"></div><div class="line">    <span class="meta">@Column</span>(name = <span class="string">"receive_amount"</span>) <span class="keyword">private</span> <span class="keyword">double</span> receiveAamount;</div><div class="line">    <span class="meta">@Column</span>(name = <span class="string">"receive_country"</span>) <span class="keyword">private</span> String receiveCountry;</div><div class="line">    <span class="meta">@Column</span>(name = <span class="string">"receive_currency"</span>) <span class="keyword">private</span> String receiveCurrency;</div><div class="line"></div><div class="line">    <span class="comment">//Money 자료형</span></div><div class="line">    <span class="keyword">private</span> Money snedMoney;</div><div class="line">    <span class="keyword">private</span> Money receiveMoney;</div><div class="line">&#125;</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Money</span> </span>&#123;</div><div class="line">    <span class="meta">@Column</span>(name = <span class="string">"amount"</span>, nullable = <span class="keyword">false</span>, updatable = <span class="keyword">false</span>) <span class="keyword">private</span> <span class="keyword">double</span> amount;</div><div class="line">    <span class="meta">@Column</span>(name = <span class="string">"country"</span>, nullable = <span class="keyword">false</span>, updatable = <span class="keyword">false</span>) <span class="keyword">private</span> Country country;</div><div class="line">    <span class="meta">@Column</span>(name = <span class="string">"currency"</span>, nullable = <span class="keyword">false</span>, updatable = <span class="keyword">false</span>) <span class="keyword">private</span> Currency currency;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>위처럼 Money라는 자료형을 두고 금액, 나라, 통화를 두면 도메인을 이해하는데 한결 수월할 뿐만 아니라 수많은 곳에서 재사용 할 수 있습니다. 사용자에게 해당 통화로 금액을 보여줄 때 소숫자리 몇 자리로 보여줄 것인지 등등 핵심 도메인일수록 재사용성을 높여 중복 코드를 제거하고 응집력을 높일 수 있습니다.</p><h2><span id="결론">결론</span></h2><p>Embedded의 장점을 계속 이야기했습니다. 자료형을 통일해서 안전성 및 재사용성을 높이고 풍부한 객체를 갖게 함으로써 많은 장점을 얻을 수 있습니다. 이러한 장점들은 객체지향 프로그래밍에 충분히 나와 있는 내용입니다. 제가 하고 싶은 이야기는 <strong>JPA는 결국 객체지향 프로그래밍을 돕는 도구</strong> 라는 이야기입니다. 실제 데이터는 관계형 데이터베이스에 저장됨으로써 객체지향과 패러다임이 일치하지 않는 부분을 JPA는 너무나도 좋게 해결해줍니다. 그러니 JPA가 주는 다양한 어노테이션, 기능들도 좋지만 결국 이것이 궁극적으로 무엇을 위한 것인지 생각해보는 것도 좋다고 생각합니다.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;해당 코드는 &lt;a href=&quot;https://github.com/cheese10yun/spring-jpa-best-practices&quot; rel=&quot;external nofollow noopener noreferrer&quot; target=&quot;_blank&quot;&gt;Git
      
    
    </summary>
    
    
      <category term="Spring" scheme="https://cheese10yun.github.io/tags/Spring/"/>
    
      <category term="JPA" scheme="https://cheese10yun.github.io/tags/JPA/"/>
    
      <category term="Best Practices" scheme="https://cheese10yun.github.io/tags/Best-Practices/"/>
    
  </entry>
  
</feed>
